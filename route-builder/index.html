<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <!-- Primary SEO -->
  <title>Night Route Builder â€” Plan Your Perfect Night Run | RunSafeTonight</title>
  <meta name="description" content="Build a personalized night running route strategy in 60 seconds. Choose your distance, environment, comfort level, and get a tailored route plan with gear checklist and safety tips.">
  <meta name="keywords" content="night running route planner, plan night run, safe running route builder, night run route tool, running route strategy, night running safety planner, route builder for runners">
  <meta name="author" content="RunSafeTonight">
  <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
  <link rel="canonical" href="https://runsafetonight.com/route-builder/">

  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://runsafetonight.com/route-builder/">
  <meta property="og:title" content="Night Route Builder â€” Plan Your Perfect Night Run">
  <meta property="og:description" content="Build a personalized night running route strategy in 60 seconds. Distance, environment, comfort, lighting â€” all tailored to your run.">
  <meta property="og:image" content="https://images.unsplash.com/photo-1552674605-db6ffd4facb5?w=1200&h=630&fit=crop">
  <meta property="og:site_name" content="RunSafeTonight">
  <meta property="og:locale" content="en_US">
  <meta property="og:locale:alternate" content="es_ES">

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Night Route Builder â€” Plan Your Perfect Night Run">
  <meta name="twitter:description" content="Build a personalized night running route strategy in 60 seconds.">
  <meta name="twitter:image" content="https://images.unsplash.com/photo-1552674605-db6ffd4facb5?w=1200&h=630&fit=crop">

  <!-- Alternate language -->
  <link rel="alternate" hreflang="en" href="https://runsafetonight.com/route-builder/">
  <link rel="alternate" hreflang="es" href="https://runsafetonight.com/es/route-builder/">
  <link rel="alternate" hreflang="x-default" href="https://runsafetonight.com/route-builder/">

  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸƒ</text></svg>">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">

  <!-- Styles -->
  <link rel="stylesheet" href="../css/style.css">

  <!-- Schema.org Structured Data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "SoftwareApplication",
    "name": "Night Route Builder",
    "description": "An interactive tool that helps night runners build personalized route strategies based on distance, environment, comfort level, surface preference, lighting needs, and time window.",
    "url": "https://runsafetonight.com/route-builder/",
    "applicationCategory": "HealthApplication",
    "operatingSystem": "Web",
    "offers": {
      "@type": "Offer",
      "price": "0",
      "priceCurrency": "USD"
    },
    "creator": {
      "@type": "Organization",
      "name": "RunSafeTonight",
      "url": "https://runsafetonight.com"
    },
    "inLanguage": ["en", "es"],
    "featureList": [
      "Personalized route strategy generation",
      "Distance planning from 1-15 miles",
      "Environment-specific guidance",
      "Gear checklist generator",
      "Shareable run plans",
      "Downloadable pre-run checklist"
    ]
  }
  </script>
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      {
        "@type": "ListItem",
        "position": 1,
        "name": "Home",
        "item": "https://runsafetonight.com/"
      },
      {
        "@type": "ListItem",
        "position": 2,
        "name": "Night Route Builder",
        "item": "https://runsafetonight.com/route-builder/"
      }
    ]
  }
  </script>
</head>
<body>

  <!-- ====== HEADER ====== -->
  <header class="site-header" role="banner">
    <div class="header-inner">
      <a href="/" class="logo" aria-label="RunSafeTonight Home">
        <div class="logo-icon">ğŸƒ</div>
        <span>RunSafe<strong>Tonight</strong></span>
      </a>

      <nav class="main-nav" role="navigation" aria-label="Main navigation">
        <a href="/#conditions">Tonight</a>
        <a href="/#environments">Environments</a>
        <a href="/#strategy">Strategy</a>
        <a href="/guides/">Guides</a>
        <a href="/route-builder/" aria-current="page">Route Builder</a>
        <a href="/#community">Community</a>
      </nav>

      <div class="header-actions">
        <div class="lang-switch" role="navigation" aria-label="Language switcher">
          <a href="/route-builder/" class="active" aria-label="English">EN</a>
          <a href="/es/route-builder/" aria-label="EspaÃ±ol">ES</a>
        </div>
        <button class="hamburger" aria-label="Open menu" aria-expanded="false" aria-controls="mobile-nav">
          <span></span>
          <span></span>
          <span></span>
        </button>
      </div>
    </div>
  </header>

  <!-- ====== MOBILE NAV ====== -->
  <nav class="mobile-nav" id="mobile-nav" role="navigation" aria-label="Mobile navigation" aria-hidden="true">
    <a href="/#conditions">Tonight's Conditions</a>
    <a href="/#environments">Environments</a>
    <a href="/#strategy">Night Strategy System</a>
    <a href="/guides/">Guides & Database</a>
    <a href="/route-builder/" aria-current="page">Night Route Builder</a>
    <a href="/#community">Community</a>
    <div class="mobile-nav-cta">
      <a href="/#nightcrew" class="btn btn--primary btn--lg" style="width:100%;text-align:center;">Join the Night Crew</a>
    </div>
  </nav>

  <main>
    <!-- ====== PAGE HERO ====== -->
    <section class="page-hero" aria-labelledby="page-title">
      <div class="page-hero-bg">
        <img src="https://images.unsplash.com/photo-1486218119243-13883505764c?w=1920&q=80" alt="Runner on a road at sunset transitioning to night" width="1920" height="800" loading="eager">
      </div>
      <div class="container">
        <div class="page-hero-content">
          <nav class="breadcrumb" aria-label="Breadcrumb">
            <a href="/">Home</a>
            <span class="breadcrumb-sep">/</span>
            <span aria-current="page">Night Route Builder</span>
          </nav>
          <span class="section-label">Interactive Tool</span>
          <h1 class="page-title" id="page-title">Night Route <span class="text-gradient">Builder</span></h1>
          <p class="page-subtitle">Build a personalized night running route strategy in 6 simple steps. Get tailored guidance, a gear checklist, and a shareable plan.</p>
        </div>
      </div>
    </section>

    <!-- ====== ROUTE BUILDER TOOL ====== -->
    <section class="section" id="route-builder-tool" aria-labelledby="tool-title">
      <div class="container container--narrow">

        <!-- Progress Indicator -->
        <div class="fade-in" id="rb-progress-section" style="margin-bottom: var(--space-2xl);">
          <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: var(--space-md);">
            <h2 class="sr-only" id="tool-title">Route Builder Steps</h2>
            <span style="font-size:var(--text-sm); font-weight:600; color:var(--text-secondary);">Step <span id="rb-step-current">1</span> of 6</span>
            <span style="font-size:var(--text-sm); font-weight:600; color:var(--accent-primary);" id="rb-step-percent">17%</span>
          </div>
          <div class="progress-bar">
            <div class="progress-bar-fill" id="rb-progress-bar" style="width:17%;"></div>
          </div>
          <!-- Step labels -->
          <div style="display:flex; justify-content:space-between; margin-top:var(--space-sm); gap:var(--space-xs);" id="rb-step-dots">
            <button class="rb-dot active" data-step="1" style="flex:1;height:4px;border-radius:2px;background:var(--accent-primary);border:none;cursor:pointer;transition:background var(--transition-fast);" aria-label="Go to Step 1"></button>
            <button class="rb-dot" data-step="2" style="flex:1;height:4px;border-radius:2px;background:rgba(255,255,255,0.1);border:none;cursor:pointer;transition:background var(--transition-fast);" aria-label="Go to Step 2"></button>
            <button class="rb-dot" data-step="3" style="flex:1;height:4px;border-radius:2px;background:rgba(255,255,255,0.1);border:none;cursor:pointer;transition:background var(--transition-fast);" aria-label="Go to Step 3"></button>
            <button class="rb-dot" data-step="4" style="flex:1;height:4px;border-radius:2px;background:rgba(255,255,255,0.1);border:none;cursor:pointer;transition:background var(--transition-fast);" aria-label="Go to Step 4"></button>
            <button class="rb-dot" data-step="5" style="flex:1;height:4px;border-radius:2px;background:rgba(255,255,255,0.1);border:none;cursor:pointer;transition:background var(--transition-fast);" aria-label="Go to Step 5"></button>
            <button class="rb-dot" data-step="6" style="flex:1;height:4px;border-radius:2px;background:rgba(255,255,255,0.1);border:none;cursor:pointer;transition:background var(--transition-fast);" aria-label="Go to Step 6"></button>
          </div>
        </div>

        <!-- Steps Container -->
        <div class="route-builder fade-in" id="rb-steps-container">

          <!-- STEP 1: Distance -->
          <div class="rb-step active" data-step="1" id="rb-step-1">
            <div style="text-align:center; margin-bottom:var(--space-xl);">
              <div style="font-size:48px; margin-bottom:var(--space-md);">ğŸ“</div>
              <h3 style="font-size:var(--text-2xl); font-weight:800; margin-bottom:var(--space-sm);">How far do you want to run?</h3>
              <p style="color:var(--text-secondary); font-size:var(--text-sm);">Slide to choose your distance.</p>
            </div>
            <div style="padding:0 var(--space-lg);">
              <div style="text-align:center; margin-bottom:var(--space-xl);">
                <span id="rb-distance-display" style="font-size:var(--text-6xl); font-weight:900; background:var(--gradient-accent); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; line-height:1;">5</span>
                <span style="font-size:var(--text-xl); color:var(--text-secondary); margin-left:var(--space-sm);">miles</span>
              </div>
              <input type="range" class="form-range" id="rb-distance-slider" min="1" max="15" value="5" step="1" aria-label="Distance in miles">
              <div style="display:flex; justify-content:space-between; margin-top:var(--space-sm); font-size:var(--text-xs); color:var(--text-muted);">
                <span>1 mi</span>
                <span>5 mi</span>
                <span>10 mi</span>
                <span>15 mi</span>
              </div>
              <div id="rb-distance-label" style="text-align:center; margin-top:var(--space-lg); padding:var(--space-md); background:rgba(0,212,255,0.05); border-radius:var(--radius-md); border:1px solid rgba(0,212,255,0.1); font-size:var(--text-sm); color:var(--text-secondary);">
                Medium distance â€” a solid night run for building confidence.
              </div>
            </div>
            <div style="text-align:center; margin-top:var(--space-2xl);">
              <button class="btn btn--primary btn--lg rb-next-btn" data-next="2">Next: Environment â†’</button>
            </div>
          </div>

          <!-- STEP 2: Environment Type -->
          <div class="rb-step" data-step="2" id="rb-step-2" style="display:none;">
            <div style="text-align:center; margin-bottom:var(--space-xl);">
              <div style="font-size:48px; margin-bottom:var(--space-md);">ğŸŒ</div>
              <h3 style="font-size:var(--text-2xl); font-weight:800; margin-bottom:var(--space-sm);">What's your running environment?</h3>
              <p style="color:var(--text-secondary); font-size:var(--text-sm);">Choose the type that best matches where you'll run tonight.</p>
            </div>
            <div style="display:grid; grid-template-columns:repeat(2,1fr); gap:var(--space-md);">
              <button class="rb-option-card" data-value="urban" aria-label="Urban Core">
                <div style="font-size:32px; margin-bottom:var(--space-sm);">ğŸ™ï¸</div>
                <div style="font-weight:700; margin-bottom:var(--space-xs);">Urban Core</div>
                <div style="font-size:var(--text-xs); color:var(--text-muted);">City streets, business corridors, streetlights</div>
              </button>
              <button class="rb-option-card" data-value="suburban" aria-label="Suburban Loop">
                <div style="font-size:32px; margin-bottom:var(--space-sm);">ğŸ˜ï¸</div>
                <div style="font-weight:700; margin-bottom:var(--space-xs);">Suburban Loop</div>
                <div style="font-size:var(--text-xs); color:var(--text-muted);">Neighborhoods, sidewalks, residential streets</div>
              </button>
              <button class="rb-option-card" data-value="campus" aria-label="Campus">
                <div style="font-size:32px; margin-bottom:var(--space-sm);">ğŸ“</div>
                <div style="font-weight:700; margin-bottom:var(--space-xs);">Campus</div>
                <div style="font-size:var(--text-xs); color:var(--text-muted);">University paths, blue light stations, quads</div>
              </button>
              <button class="rb-option-card" data-value="park" aria-label="Park Trail">
                <div style="font-size:32px; margin-bottom:var(--space-sm);">ğŸŒ³</div>
                <div style="font-weight:700; margin-bottom:var(--space-xs);">Park Trail</div>
                <div style="font-size:var(--text-xs); color:var(--text-muted);">Parks, trails, natural surfaces</div>
              </button>
              <button class="rb-option-card" data-value="waterfront" aria-label="Waterfront">
                <div style="font-size:32px; margin-bottom:var(--space-sm);">ğŸŒŠ</div>
                <div style="font-weight:700; margin-bottom:var(--space-xs);">Waterfront</div>
                <div style="font-size:var(--text-xs); color:var(--text-muted);">Coastal paths, boardwalks, lake trails</div>
              </button>
              <button class="rb-option-card" data-value="travel" aria-label="Travel / Hotel">
                <div style="font-size:32px; margin-bottom:var(--space-sm);">âœˆï¸</div>
                <div style="font-weight:700; margin-bottom:var(--space-xs);">Travel</div>
                <div style="font-size:var(--text-xs); color:var(--text-muted);">New city, hotel-radius, unfamiliar area</div>
              </button>
            </div>
            <div style="display:flex; justify-content:space-between; margin-top:var(--space-2xl); gap:var(--space-md);">
              <button class="btn btn--secondary rb-prev-btn" data-prev="1">â† Back</button>
              <button class="btn btn--primary rb-next-btn" data-next="3" id="rb-env-next" disabled style="opacity:0.5;">Next: Comfort â†’</button>
            </div>
          </div>

          <!-- STEP 3: Comfort Level -->
          <div class="rb-step" data-step="3" id="rb-step-3" style="display:none;">
            <div style="text-align:center; margin-bottom:var(--space-xl);">
              <div style="font-size:48px; margin-bottom:var(--space-md);">ğŸ›¡ï¸</div>
              <h3 style="font-size:var(--text-2xl); font-weight:800; margin-bottom:var(--space-sm);">What's your comfort level?</h3>
              <p style="color:var(--text-secondary); font-size:var(--text-sm);">How do you feel about street activity during your run?</p>
            </div>
            <div style="display:flex; flex-direction:column; gap:var(--space-md);">
              <button class="rb-option-btn" data-value="busy">
                <span style="font-size:20px; flex-shrink:0;">ğŸš¦</span>
                <div>
                  <div style="font-weight:700;">Prefer Busy Streets</div>
                  <div style="font-size:var(--text-xs); color:var(--text-muted);">More people, more lights, more activity around me</div>
                </div>
              </button>
              <button class="rb-option-btn" data-value="mixed">
                <span style="font-size:20px; flex-shrink:0;">âš–ï¸</span>
                <div>
                  <div style="font-weight:700;">Mixed Is Fine</div>
                  <div style="font-size:var(--text-xs); color:var(--text-muted);">A blend of busy corridors and quieter stretches</div>
                </div>
              </button>
              <button class="rb-option-btn" data-value="quiet">
                <span style="font-size:20px; flex-shrink:0;">ğŸŒ™</span>
                <div>
                  <div style="font-weight:700;">Prefer Quiet Routes</div>
                  <div style="font-size:var(--text-xs); color:var(--text-muted);">Fewer people, more solitude, peaceful running</div>
                </div>
              </button>
            </div>
            <div style="display:flex; justify-content:space-between; margin-top:var(--space-2xl); gap:var(--space-md);">
              <button class="btn btn--secondary rb-prev-btn" data-prev="2">â† Back</button>
              <button class="btn btn--primary rb-next-btn" data-next="4" disabled style="opacity:0.5;">Next: Surface â†’</button>
            </div>
          </div>

          <!-- STEP 4: Surface Preference -->
          <div class="rb-step" data-step="4" id="rb-step-4" style="display:none;">
            <div style="text-align:center; margin-bottom:var(--space-xl);">
              <div style="font-size:48px; margin-bottom:var(--space-md);">ğŸ‘Ÿ</div>
              <h3 style="font-size:var(--text-2xl); font-weight:800; margin-bottom:var(--space-sm);">What surfaces work for you?</h3>
              <p style="color:var(--text-secondary); font-size:var(--text-sm);">Surface affects footing, visibility, and shoe choice at night.</p>
            </div>
            <div style="display:flex; flex-direction:column; gap:var(--space-md);">
              <button class="rb-option-btn" data-value="paved">
                <span style="font-size:20px; flex-shrink:0;">ğŸ›¤ï¸</span>
                <div>
                  <div style="font-weight:700;">Paved Only</div>
                  <div style="font-size:var(--text-xs); color:var(--text-muted);">Sidewalks, asphalt, concrete paths only</div>
                </div>
              </button>
              <button class="rb-option-btn" data-value="mixed-surface">
                <span style="font-size:20px; flex-shrink:0;">ğŸ”€</span>
                <div>
                  <div style="font-weight:700;">Mixed Surfaces OK</div>
                  <div style="font-size:var(--text-xs); color:var(--text-muted);">Some gravel, packed dirt, or crushed stone is fine</div>
                </div>
              </button>
              <button class="rb-option-btn" data-value="trail-ok">
                <span style="font-size:20px; flex-shrink:0;">ğŸ¥¾</span>
                <div>
                  <div style="font-weight:700;">Trail OK</div>
                  <div style="font-size:var(--text-xs); color:var(--text-muted);">I'm comfortable on natural trail surfaces at night</div>
                </div>
              </button>
            </div>
            <div style="display:flex; justify-content:space-between; margin-top:var(--space-2xl); gap:var(--space-md);">
              <button class="btn btn--secondary rb-prev-btn" data-prev="3">â† Back</button>
              <button class="btn btn--primary rb-next-btn" data-next="5" disabled style="opacity:0.5;">Next: Lighting â†’</button>
            </div>
          </div>

          <!-- STEP 5: Lighting Preference -->
          <div class="rb-step" data-step="5" id="rb-step-5" style="display:none;">
            <div style="text-align:center; margin-bottom:var(--space-xl);">
              <div style="font-size:48px; margin-bottom:var(--space-md);">ğŸ’¡</div>
              <h3 style="font-size:var(--text-2xl); font-weight:800; margin-bottom:var(--space-sm);">What's your lighting preference?</h3>
              <p style="color:var(--text-secondary); font-size:var(--text-sm);">How much ambient light do you need along your route?</p>
            </div>
            <div style="display:flex; flex-direction:column; gap:var(--space-md);">
              <button class="rb-option-btn" data-value="well-lit">
                <span style="font-size:20px; flex-shrink:0;">ğŸ”†</span>
                <div>
                  <div style="font-weight:700;">Well-Lit Only</div>
                  <div style="font-size:var(--text-xs); color:var(--text-muted);">Consistent streetlights, no dark gaps</div>
                </div>
              </button>
              <button class="rb-option-btn" data-value="some-dark">
                <span style="font-size:20px; flex-shrink:0;">ğŸŒ“</span>
                <div>
                  <div style="font-weight:700;">Some Dark Stretches OK</div>
                  <div style="font-size:var(--text-xs); color:var(--text-muted);">Mostly lit, but I can handle brief dark sections</div>
                </div>
              </button>
              <button class="rb-option-btn" data-value="own-light">
                <span style="font-size:20px; flex-shrink:0;">ğŸ”¦</span>
                <div>
                  <div style="font-weight:700;">I Bring My Own Light</div>
                  <div style="font-size:var(--text-xs); color:var(--text-muted);">Headlamp or waist light â€” I don't depend on street lighting</div>
                </div>
              </button>
            </div>
            <div style="display:flex; justify-content:space-between; margin-top:var(--space-2xl); gap:var(--space-md);">
              <button class="btn btn--secondary rb-prev-btn" data-prev="4">â† Back</button>
              <button class="btn btn--primary rb-next-btn" data-next="6" disabled style="opacity:0.5;">Next: Time â†’</button>
            </div>
          </div>

          <!-- STEP 6: Time Window -->
          <div class="rb-step" data-step="6" id="rb-step-6" style="display:none;">
            <div style="text-align:center; margin-bottom:var(--space-xl);">
              <div style="font-size:48px; margin-bottom:var(--space-md);">ğŸ•</div>
              <h3 style="font-size:var(--text-2xl); font-weight:800; margin-bottom:var(--space-sm);">When are you running?</h3>
              <p style="color:var(--text-secondary); font-size:var(--text-sm);">Time of night changes everything â€” traffic, lighting, and street activity.</p>
            </div>
            <div style="display:flex; flex-direction:column; gap:var(--space-md);">
              <button class="rb-option-btn" data-value="before-sunset">
                <span style="font-size:20px; flex-shrink:0;">ğŸŒ…</span>
                <div>
                  <div style="font-weight:700;">Before Sunset</div>
                  <div style="font-size:var(--text-xs); color:var(--text-muted);">Starting in daylight, may finish at dusk</div>
                </div>
              </button>
              <button class="rb-option-btn" data-value="dusk">
                <span style="font-size:20px; flex-shrink:0;">ğŸŒ†</span>
                <div>
                  <div style="font-weight:700;">Sunset / Dusk</div>
                  <div style="font-size:var(--text-xs); color:var(--text-muted);">The golden hour transition into darkness</div>
                </div>
              </button>
              <button class="rb-option-btn" data-value="early-evening">
                <span style="font-size:20px; flex-shrink:0;">ğŸŒƒ</span>
                <div>
                  <div style="font-weight:700;">Early Evening (6-9 PM)</div>
                  <div style="font-size:var(--text-xs); color:var(--text-muted);">Post-dinner, streets still active</div>
                </div>
              </button>
              <button class="rb-option-btn" data-value="late-evening">
                <span style="font-size:20px; flex-shrink:0;">ğŸŒ™</span>
                <div>
                  <div style="font-weight:700;">Late Evening (9 PM - Midnight)</div>
                  <div style="font-size:var(--text-xs); color:var(--text-muted);">Streets quieting, fewer pedestrians</div>
                </div>
              </button>
              <button class="rb-option-btn" data-value="after-midnight">
                <span style="font-size:20px; flex-shrink:0;">ğŸŒ‘</span>
                <div>
                  <div style="font-weight:700;">After Midnight</div>
                  <div style="font-size:var(--text-xs); color:var(--text-muted);">Deep night, minimal street activity</div>
                </div>
              </button>
            </div>
            <div style="display:flex; justify-content:space-between; margin-top:var(--space-2xl); gap:var(--space-md);">
              <button class="btn btn--secondary rb-prev-btn" data-prev="5">â† Back</button>
              <button class="btn btn--primary btn--lg rb-generate-btn" disabled style="opacity:0.5;">Generate My Route Strategy</button>
            </div>
          </div>

        </div><!-- /rb-steps-container -->

        <!-- ====== GENERATED RESULTS ====== -->
        <div id="rb-results" style="display:none;" class="fade-in">

          <!-- Confidence Score -->
          <div class="route-builder" style="text-align:center; margin-bottom:var(--space-2xl);">
            <div style="font-size:var(--text-sm); font-weight:700; text-transform:uppercase; letter-spacing:0.1em; color:var(--accent-primary); margin-bottom:var(--space-md);">Your Route Strategy</div>
            <div style="font-size:var(--text-7xl); font-weight:900; line-height:1; margin-bottom:var(--space-sm);">
              <span class="text-gradient" id="rb-confidence-score">0</span>
            </div>
            <div style="font-size:var(--text-xl); font-weight:700; margin-bottom:var(--space-sm);">Confidence Score</div>
            <div id="rb-score-label" style="font-size:var(--text-sm); color:var(--text-secondary); max-width:500px; margin:0 auto;"></div>
            <div style="margin-top:var(--space-lg);">
              <div class="progress-bar" style="max-width:300px; margin:0 auto; height:8px;">
                <div class="progress-bar-fill" id="rb-score-bar" style="width:0%; transition:width 1.5s ease;"></div>
              </div>
            </div>
          </div>

          <!-- Route Design Guidance -->
          <div class="route-builder" style="margin-bottom:var(--space-2xl);">
            <h3 style="font-size:var(--text-xl); font-weight:800; margin-bottom:var(--space-lg); display:flex; align-items:center; gap:var(--space-sm);">
              <span style="font-size:24px;">ğŸ—ºï¸</span> Route Design Guidance
            </h3>
            <div id="rb-route-design" style="display:flex; flex-direction:column; gap:var(--space-md);"></div>
          </div>

          <!-- Environment-Specific Tips -->
          <div class="route-builder" style="margin-bottom:var(--space-2xl);">
            <h3 style="font-size:var(--text-xl); font-weight:800; margin-bottom:var(--space-lg); display:flex; align-items:center; gap:var(--space-sm);">
              <span style="font-size:24px;">ğŸ¯</span> Environment-Specific Tips
            </h3>
            <div id="rb-env-tips" style="display:flex; flex-direction:column; gap:var(--space-md);"></div>
          </div>

          <!-- Gear Checklist -->
          <div class="route-builder" style="margin-bottom:var(--space-2xl);">
            <h3 style="font-size:var(--text-xl); font-weight:800; margin-bottom:var(--space-lg); display:flex; align-items:center; gap:var(--space-sm);">
              <span style="font-size:24px;">ğŸ’</span> Gear Checklist
            </h3>
            <p style="font-size:var(--text-sm); color:var(--text-secondary); margin-bottom:var(--space-lg);">Check off items as you prepare. Tailored to your selections.</p>
            <div id="rb-gear-checklist" style="display:flex; flex-direction:column; gap:var(--space-sm);"></div>
          </div>

          <!-- Action Buttons -->
          <div class="route-builder" style="margin-bottom:var(--space-2xl); text-align:center;">
            <h3 style="font-size:var(--text-xl); font-weight:800; margin-bottom:var(--space-lg);">Ready to Run?</h3>
            <div style="display:flex; flex-wrap:wrap; justify-content:center; gap:var(--space-md);">
              <button class="btn btn--primary btn--lg" id="rb-share-btn">
                Share Your Plan
              </button>
              <button class="btn btn--secondary btn--lg" id="rb-download-btn">
                Download Checklist
              </button>
              <button class="btn btn--secondary" id="rb-restart-btn">
                Start Over
              </button>
            </div>
          </div>

          <!-- Related Strategy Pillars -->
          <div style="margin-bottom:var(--space-2xl);">
            <h3 style="font-size:var(--text-xl); font-weight:800; margin-bottom:var(--space-lg); text-align:center;">Deepen Your Strategy</h3>
            <div class="strategy-grid stagger-children" style="grid-template-columns:repeat(auto-fit, minmax(220px,1fr));">
              <a href="/strategy/route-intelligence.html" class="strategy-card fade-in">
                <div class="strategy-card-icon">ğŸ—ºï¸</div>
                <h3 class="strategy-card-title">Route Intelligence</h3>
                <p class="strategy-card-desc">Loop design, exit points, timing strategy, and confidence zone mapping.</p>
              </a>
              <a href="/strategy/visual-presence.html" class="strategy-card fade-in">
                <div class="strategy-card-icon">ğŸ’¡</div>
                <h3 class="strategy-card-title">Visual Presence</h3>
                <p class="strategy-card-desc">Reflective geometry, headlamp vs waist light, and high-contrast placement.</p>
              </a>
              <a href="/strategy/situational-awareness.html" class="strategy-card fade-in">
                <div class="strategy-card-icon">ğŸ‘ï¸</div>
                <h3 class="strategy-card-title">Situational Awareness</h3>
                <p class="strategy-card-desc">Scanning rhythm, headphone protocol, and intuition calibration.</p>
              </a>
              <a href="/strategy/emotional-resilience.html" class="strategy-card fade-in">
                <div class="strategy-card-icon">ğŸ§ </div>
                <h3 class="strategy-card-title">Emotional Resilience</h3>
                <p class="strategy-card-desc">Reducing hypervigilance fatigue, breath resets, and confidence building.</p>
              </a>
              <a href="/strategy/community-safety.html" class="strategy-card fade-in">
                <div class="strategy-card-icon">ğŸ¤</div>
                <h3 class="strategy-card-title">Community Safety</h3>
                <p class="strategy-card-desc">Buddy systems, route sharing, and trusted route networks.</p>
              </a>
            </div>
          </div>

        </div><!-- /rb-results -->

      </div>
    </section>
  </main>

  <!-- ====== FOOTER ====== -->
  <footer class="site-footer" role="contentinfo">
    <div class="container">
      <div class="footer-grid">
        <div class="footer-brand">
          <div class="footer-brand-logo">
            <span class="text-gradient">RunSafeTonight</span>
          </div>
          <p class="footer-brand-desc">The global headquarters for night running freedom. Empowering runners to own the night with strategy, confidence, and community.</p>
        </div>

        <div>
          <h4 class="footer-col-title">Strategy</h4>
          <div class="footer-links">
            <a href="/strategy/route-intelligence.html">Route Intelligence</a>
            <a href="/strategy/visual-presence.html">Visual Presence</a>
            <a href="/strategy/situational-awareness.html">Situational Awareness</a>
            <a href="/strategy/emotional-resilience.html">Emotional Resilience</a>
            <a href="/strategy/community-safety.html">Community Safety</a>
          </div>
        </div>

        <div>
          <h4 class="footer-col-title">Environments</h4>
          <div class="footer-links">
            <a href="/environments/urban-core.html">Urban Core</a>
            <a href="/environments/suburban-loop.html">Suburban Loop</a>
            <a href="/environments/campus.html">Campus</a>
            <a href="/environments/park-trail.html">Park Trail</a>
            <a href="/environments/waterfront.html">Waterfront</a>
            <a href="/environments/travel.html">Travel / Hotel</a>
          </div>
        </div>

        <div>
          <h4 class="footer-col-title">Resources</h4>
          <div class="footer-links">
            <a href="/guides/">Guides Database</a>
            <a href="/route-builder/">Night Route Builder</a>
            <a href="/guides/#city-guides">City Guides</a>
            <a href="/guides/#community-stories">Community Stories</a>
            <a href="/#nightcrew">Join Night Crew</a>
            <a href="/es/route-builder/">Herramienta en EspaÃ±ol</a>
          </div>
        </div>
      </div>

      <div class="footer-bottom">
        <p class="footer-bottom-text">&copy; 2026 RunSafeTonight.com â€” Own the Night. All rights reserved.</p>
        <p class="footer-bottom-text" style="font-size: var(--text-xs);">Agency over fear. Empowerment first. Always.</p>
      </div>
    </div>
  </footer>

  <!-- Back to Top -->
  <button class="back-to-top" aria-label="Back to top" id="back-to-top">â†‘</button>

  <!-- Toast -->
  <div class="toast" id="toast" role="alert" aria-live="polite"></div>

  <!-- Global JS -->
  <script src="../js/main.js"></script>

  <!-- ====== PAGE-SPECIFIC ROUTE BUILDER JS ====== -->
  <script>
  (function() {
    'use strict';

    // ---- State ----
    var state = {
      step: 1,
      distance: 5,
      environment: null,
      comfort: null,
      surface: null,
      lighting: null,
      time: null
    };

    // ---- Initialization ----
    document.addEventListener('DOMContentLoaded', function() {
      initDistanceSlider();
      initOptionCards();
      initOptionButtons();
      initNavButtons();
      initStepDots();
      initGenerateButton();
      initResultActions();
    });

    // ============================================================
    // STEP 1: Distance Slider
    // ============================================================
    function initDistanceSlider() {
      var slider = document.getElementById('rb-distance-slider');
      var display = document.getElementById('rb-distance-display');
      var label = document.getElementById('rb-distance-label');
      if (!slider) return;

      function updateDistance() {
        var val = parseInt(slider.value);
        state.distance = val;
        if (display) display.textContent = val;
        if (label) label.textContent = getDistanceLabel(val);
      }

      slider.addEventListener('input', updateDistance);
      updateDistance();
    }

    function getDistanceLabel(miles) {
      if (miles <= 2) return 'Quick shakeout â€” perfect for a first night run or staying close to home.';
      if (miles <= 4) return 'Short and sweet â€” a great confidence builder for night running.';
      if (miles <= 6) return 'Medium distance â€” a solid night run for building confidence.';
      if (miles <= 8) return 'Getting into long run territory. Make sure your route has bail-out points.';
      if (miles <= 10) return 'Solid distance. Plan multiple loops or segments with well-lit checkpoints.';
      if (miles <= 12) return 'Long night run. Hydration, nutrition, and multiple safety checkpoints are essential.';
      return 'Ultra territory at night. This requires advanced planning and multiple safety layers.';
    }

    // ============================================================
    // STEP 2: Environment Cards
    // ============================================================
    function initOptionCards() {
      var cards = document.querySelectorAll('.rb-option-card');
      cards.forEach(function(card) {
        card.addEventListener('click', function() {
          // Deselect siblings
          var siblings = card.parentElement.querySelectorAll('.rb-option-card');
          siblings.forEach(function(s) { s.classList.remove('selected'); });
          card.classList.add('selected');

          state.environment = card.getAttribute('data-value');

          // Enable next button
          var nextBtn = card.closest('.rb-step').querySelector('.rb-next-btn');
          if (nextBtn) {
            nextBtn.disabled = false;
            nextBtn.style.opacity = '1';
          }
        });
      });
    }

    // ============================================================
    // STEPS 3-6: Option Buttons
    // ============================================================
    function initOptionButtons() {
      var allBtns = document.querySelectorAll('.rb-option-btn');
      allBtns.forEach(function(btn) {
        btn.addEventListener('click', function() {
          var step = btn.closest('.rb-step');
          var stepNum = parseInt(step.getAttribute('data-step'));

          // Deselect siblings
          step.querySelectorAll('.rb-option-btn').forEach(function(s) {
            s.classList.remove('selected');
          });
          btn.classList.add('selected');

          // Store value
          var val = btn.getAttribute('data-value');
          if (stepNum === 3) state.comfort = val;
          else if (stepNum === 4) state.surface = val;
          else if (stepNum === 5) state.lighting = val;
          else if (stepNum === 6) state.time = val;

          // Enable next/generate button
          var nextBtn = step.querySelector('.rb-next-btn') || step.querySelector('.rb-generate-btn');
          if (nextBtn) {
            nextBtn.disabled = false;
            nextBtn.style.opacity = '1';
          }
        });
      });
    }

    // ============================================================
    // Navigation (Next/Prev)
    // ============================================================
    function initNavButtons() {
      document.querySelectorAll('.rb-next-btn').forEach(function(btn) {
        btn.addEventListener('click', function() {
          var next = parseInt(btn.getAttribute('data-next'));
          goToStep(next);
        });
      });

      document.querySelectorAll('.rb-prev-btn').forEach(function(btn) {
        btn.addEventListener('click', function() {
          var prev = parseInt(btn.getAttribute('data-prev'));
          goToStep(prev);
        });
      });
    }

    function initStepDots() {
      document.querySelectorAll('.rb-dot').forEach(function(dot) {
        dot.addEventListener('click', function() {
          var target = parseInt(dot.getAttribute('data-step'));
          // Only allow going to completed steps or current
          if (target <= state.step) {
            goToStep(target);
          }
        });
      });
    }

    function goToStep(num) {
      // Hide all steps
      document.querySelectorAll('.rb-step').forEach(function(s) {
        s.style.display = 'none';
        s.classList.remove('active');
      });

      // Show target step
      var target = document.getElementById('rb-step-' + num);
      if (target) {
        target.style.display = 'block';
        target.style.opacity = '0';
        target.style.transform = 'translateY(20px)';
        // Trigger animation
        requestAnimationFrame(function() {
          target.style.transition = 'opacity 0.4s ease, transform 0.4s ease';
          target.style.opacity = '1';
          target.style.transform = 'translateY(0)';
        });
        target.classList.add('active');
      }

      state.step = num;
      updateProgress(num);

      // Scroll to top of tool
      var container = document.getElementById('rb-steps-container');
      if (container) {
        var rect = container.getBoundingClientRect();
        if (rect.top < 0 || rect.top > window.innerHeight * 0.5) {
          window.scrollTo({
            top: container.offsetTop - 100,
            behavior: 'smooth'
          });
        }
      }
    }

    function updateProgress(step) {
      var pct = Math.round((step / 6) * 100);
      var bar = document.getElementById('rb-progress-bar');
      var num = document.getElementById('rb-step-current');
      var percent = document.getElementById('rb-step-percent');

      if (bar) bar.style.width = pct + '%';
      if (num) num.textContent = step;
      if (percent) percent.textContent = pct + '%';

      // Update dots
      document.querySelectorAll('.rb-dot').forEach(function(dot) {
        var dotStep = parseInt(dot.getAttribute('data-step'));
        if (dotStep <= step) {
          dot.style.background = 'var(--accent-primary)';
        } else {
          dot.style.background = 'rgba(255,255,255,0.1)';
        }
      });
    }

    // ============================================================
    // Generate Results
    // ============================================================
    function initGenerateButton() {
      var btn = document.querySelector('.rb-generate-btn');
      if (!btn) return;

      btn.addEventListener('click', function() {
        if (btn.disabled) return;
        generateResults();
      });
    }

    function generateResults() {
      // Hide steps, show results
      var stepsContainer = document.getElementById('rb-steps-container');
      var progressSection = document.getElementById('rb-progress-section');
      var results = document.getElementById('rb-results');

      if (stepsContainer) stepsContainer.style.display = 'none';
      if (progressSection) progressSection.style.display = 'none';
      if (results) {
        results.style.display = 'block';
        results.style.opacity = '0';
        results.style.transform = 'translateY(30px)';
        requestAnimationFrame(function() {
          results.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
          results.style.opacity = '1';
          results.style.transform = 'translateY(0)';
        });
      }

      // Scroll to top
      window.scrollTo({ top: 0, behavior: 'smooth' });

      // Calculate confidence score
      var score = calculateConfidence();

      // Animate score
      setTimeout(function() {
        animateScore(score);
      }, 400);

      // Fill sections
      fillScoreLabel(score);
      fillRouteDesign();
      fillEnvTips();
      fillGearChecklist();

      // Re-init scroll animations for new content
      initScrollAnimationsForResults();
    }

    function calculateConfidence() {
      var score = 50; // base

      // Distance factor (shorter = safer for beginners)
      if (state.distance <= 3) score += 12;
      else if (state.distance <= 6) score += 8;
      else if (state.distance <= 10) score += 4;
      else score += 0;

      // Environment factor
      var envScores = { urban: 10, campus: 10, suburban: 7, waterfront: 6, park: 4, travel: 3 };
      score += envScores[state.environment] || 5;

      // Comfort factor
      if (state.comfort === 'busy') score += 8;
      else if (state.comfort === 'mixed') score += 5;
      else score += 2;

      // Surface factor
      if (state.surface === 'paved') score += 6;
      else if (state.surface === 'mixed-surface') score += 4;
      else score += 2;

      // Lighting factor
      if (state.lighting === 'well-lit') score += 8;
      else if (state.lighting === 'some-dark') score += 5;
      else score += 3;

      // Time factor
      var timeScores = { 'before-sunset': 10, 'dusk': 8, 'early-evening': 6, 'late-evening': 3, 'after-midnight': 1 };
      score += timeScores[state.time] || 4;

      return Math.min(Math.max(score, 30), 98);
    }

    function animateScore(target) {
      var el = document.getElementById('rb-confidence-score');
      var bar = document.getElementById('rb-score-bar');
      if (!el) return;

      var current = 0;
      var duration = 1500;
      var startTime = null;

      function step(timestamp) {
        if (!startTime) startTime = timestamp;
        var progress = Math.min((timestamp - startTime) / duration, 1);
        var eased = 1 - Math.pow(1 - progress, 3);
        current = Math.round(target * eased);
        el.textContent = current;
        if (bar) bar.style.width = current + '%';
        if (progress < 1) requestAnimationFrame(step);
      }
      requestAnimationFrame(step);
    }

    function fillScoreLabel(score) {
      var el = document.getElementById('rb-score-label');
      if (!el) return;

      if (score >= 85) {
        el.textContent = 'Excellent conditions profile. Your selections indicate a high-safety route with strong infrastructure support. Confidence is high â€” enjoy the run.';
      } else if (score >= 70) {
        el.textContent = 'Strong route profile. Your combination of environment, lighting, and timing creates a solid foundation. Follow the tips below to maximize your safety.';
      } else if (score >= 55) {
        el.textContent = 'Moderate route profile. Some of your selections add complexity. Pay extra attention to the guidance below and consider the gear checklist carefully.';
      } else {
        el.textContent = 'Challenging route profile. Your selections indicate some risk factors. Follow every recommendation below and consider adjusting distance or timing for your first attempts.';
      }
    }

    function fillRouteDesign() {
      var el = document.getElementById('rb-route-design');
      if (!el) return;

      var tips = [];

      // Loop vs out-and-back
      if (state.distance <= 4) {
        tips.push({
          icon: 'ğŸ”„',
          title: 'Single Loop Recommended',
          text: 'At ' + state.distance + ' miles, a single loop route is ideal. Start and finish at the same point â€” no retracing steps, no predictable patterns.'
        });
      } else if (state.distance <= 8) {
        tips.push({
          icon: 'ğŸ”„',
          title: 'Cloverleaf or Figure-8 Design',
          text: 'At ' + state.distance + ' miles, use a cloverleaf or figure-8 pattern. This keeps you within a familiar zone while covering distance, with multiple bail-out points back to your start.'
        });
      } else {
        tips.push({
          icon: 'ğŸ”„',
          title: 'Stacked Loop Strategy',
          text: 'At ' + state.distance + ' miles, plan 2-3 stacked loops from a home base. This way you pass your start every 3-4 miles â€” perfect for hydration, safety checks, and the option to cut short.'
        });
      }

      // Time-based guidance
      if (state.time === 'before-sunset' || state.time === 'dusk') {
        tips.push({
          icon: 'ğŸŒ…',
          title: 'Sunset Transition Planning',
          text: 'Plan your route so the first half heads away from your start point. As darkness falls on your return, you\'ll be covering familiar ground â€” this makes the transition feel natural.'
        });
      } else if (state.time === 'late-evening' || state.time === 'after-midnight') {
        tips.push({
          icon: 'ğŸŒ™',
          title: 'Late Night Corridor Strategy',
          text: 'Stick to main corridors where late-night businesses (gas stations, restaurants, 24-hour stores) provide ambient light and human presence. Avoid residential dead-ends.'
        });
      } else {
        tips.push({
          icon: 'ğŸ™ï¸',
          title: 'Peak Evening Advantage',
          text: 'Early evening is the sweet spot for night running. Restaurants and stores are open, streets are active, and lighting is fully engaged. Use this window to explore new routes.'
        });
      }

      // Bail-out points
      var bailInterval = state.distance <= 5 ? 'every half mile' : 'every mile';
      tips.push({
        icon: 'ğŸšª',
        title: 'Exit Point Planning',
        text: 'Map at least one bail-out point ' + bailInterval + '. Identify well-lit locations (stores, gas stations, busy intersections) where you could stop, call a ride, or wait safely.'
      });

      // Direction
      if (state.comfort === 'busy') {
        tips.push({
          icon: 'ğŸ‘€',
          title: 'Run Against Traffic',
          text: 'On streets without sidewalks, run facing oncoming traffic so you can see approaching vehicles. On sidewalks, choose the side with better lighting.'
        });
      }

      el.innerHTML = tips.map(function(t) {
        return '<div style="display:flex; gap:var(--space-md); padding:var(--space-lg); background:rgba(255,255,255,0.02); border:1px solid var(--border-subtle); border-radius:var(--radius-md);">' +
          '<div style="font-size:24px; flex-shrink:0;">' + t.icon + '</div>' +
          '<div><div style="font-weight:700; margin-bottom:var(--space-xs);">' + t.title + '</div>' +
          '<div style="font-size:var(--text-sm); color:var(--text-secondary); line-height:1.7;">' + t.text + '</div></div></div>';
      }).join('');
    }

    function fillEnvTips() {
      var el = document.getElementById('rb-env-tips');
      if (!el) return;

      var tipsMap = {
        urban: [
          { icon: 'ğŸš¦', text: 'Use traffic signals and crosswalks as built-in checkpoints. Time your loops to hit green lights.' },
          { icon: 'ğŸª', text: 'Route past open businesses â€” they provide light, witnesses, and emergency options.' },
          { icon: 'ğŸ‘¥', text: 'Run during the dinner rush (6-8 PM) for maximum street activity and safety.' },
          { icon: 'ğŸš—', text: 'Wear reflective gear on your ankles and wrists â€” drivers see movement at extremities first.' }
        ],
        suburban: [
          { icon: 'ğŸ’¡', text: 'Stick to streets with consistent streetlighting. Scout problem areas in daylight first.' },
          { icon: 'ğŸ ', text: 'Note which homes have porch lights and motion-sensor lights â€” these become your safety network.' },
          { icon: 'ğŸ•', text: 'Be aware of loose dogs. Carry a small flashlight to deter animals if needed.' },
          { icon: 'ğŸ”€', text: 'Vary your route pattern â€” don\'t run the same loop at the same time every night.' }
        ],
        campus: [
          { icon: 'ğŸ”µ', text: 'Map all blue-light emergency stations along your route. Run within their coverage area.' },
          { icon: 'ğŸ«', text: 'Use well-lit building perimeters as corridors. Academic buildings often have excellent outdoor lighting.' },
          { icon: 'ğŸ‘®', text: 'Know the campus security number by heart and note patrol patterns.' },
          { icon: 'ğŸš¶', text: 'Run during times when other students are walking â€” after evening classes or library hours.' }
        ],
        park: [
          { icon: 'ğŸ”¦', text: 'A 400+ lumen headlamp is essential. Bring a backup light source.' },
          { icon: 'ğŸŒ¿', text: 'Stay on main paths â€” trail junctions are where people get lost at night. Know the route.' },
          { icon: 'ğŸ“±', text: 'Download offline maps. Cell coverage can be spotty in parks.' },
          { icon: 'ğŸƒ', text: 'Run park routes in daylight first to memorize terrain, turns, and surface changes.' }
        ],
        waterfront: [
          { icon: 'ğŸ’¨', text: 'Wind is stronger near water. Dress in wind-resistant layers and protect exposed skin.' },
          { icon: 'ğŸŒŠ', text: 'Stay away from unfenced water edges. Wet surfaces are slippery â€” reduce pace on turns.' },
          { icon: 'ğŸ”†', text: 'Waterfront paths often have lighting gaps. Carry your own light even if the route is "lit."' },
          { icon: 'ğŸ§­', text: 'Waterfront paths can feel isolated. Run during hours when dog-walkers and other runners are present.' }
        ],
        travel: [
          { icon: 'ğŸ¨', text: 'Do a daylight recon walk first. Note landmarks, safe-looking businesses, and your hotel\'s exact location.' },
          { icon: 'ğŸ“', text: 'Stay within a 1-mile radius of your hotel on your first night run in a new city.' },
          { icon: 'ğŸ—£ï¸', text: 'Ask the front desk about safe running routes â€” hotel staff know the area.' },
          { icon: 'ğŸ“±', text: 'Screenshot your route and hotel address. Don\'t rely on cell data in unfamiliar areas.' }
        ]
      };

      var tips = tipsMap[state.environment] || tipsMap.urban;
      el.innerHTML = tips.map(function(t) {
        return '<div style="display:flex; gap:var(--space-md); padding:var(--space-md) var(--space-lg); background:rgba(255,255,255,0.02); border:1px solid var(--border-subtle); border-radius:var(--radius-md);">' +
          '<div style="font-size:20px; flex-shrink:0;">' + t.icon + '</div>' +
          '<div style="font-size:var(--text-sm); color:var(--text-secondary); line-height:1.7;">' + t.text + '</div></div>';
      }).join('');
    }

    function fillGearChecklist() {
      var el = document.getElementById('rb-gear-checklist');
      if (!el) return;

      var items = [];

      // Universal items
      items.push('Phone â€” fully charged, with location sharing active');
      items.push('ID and emergency contact info');

      // Lighting-based
      if (state.lighting === 'own-light') {
        items.push('Primary headlamp or waist light (400+ lumens recommended)');
        items.push('Backup light source (small clip-on or handheld)');
      } else if (state.lighting === 'some-dark') {
        items.push('Headlamp or waist light for dark stretches');
      } else {
        items.push('Small clip-on light (for visibility, even on lit routes)');
      }

      // Always reflective
      items.push('Reflective vest or jacket');
      items.push('Reflective bands on ankles and wrists');

      // Surface-based
      if (state.surface === 'trail-ok') {
        items.push('Trail shoes with good grip');
        items.push('Gaiters if running on loose terrain');
      } else if (state.surface === 'mixed-surface') {
        items.push('Shoes with versatile tread for mixed surfaces');
      }

      // Distance-based
      if (state.distance >= 6) {
        items.push('Hydration â€” handheld bottle or hydration vest');
      }
      if (state.distance >= 10) {
        items.push('Nutrition â€” gels or chews for sustained energy');
        items.push('Extra layer in case of extended time outside');
      }

      // Time-based
      if (state.time === 'late-evening' || state.time === 'after-midnight') {
        items.push('Personal safety alarm or whistle');
        items.push('Pepper spray or personal safety device (where legal)');
      }

      // Environment-based
      if (state.environment === 'waterfront') {
        items.push('Wind-resistant outer layer');
      }
      if (state.environment === 'travel') {
        items.push('Hotel key and address card');
        items.push('Local currency / payment method for emergency transport');
      }

      // Always last
      items.push('Share your route and ETA with a trusted contact');

      el.innerHTML = items.map(function(item, i) {
        return '<label style="display:flex; align-items:flex-start; gap:var(--space-md); padding:var(--space-md); background:rgba(255,255,255,0.02); border:1px solid var(--border-subtle); border-radius:var(--radius-md); cursor:pointer; transition:all var(--transition-fast);" onmouseover="this.style.background=\'rgba(0,212,255,0.05)\'" onmouseout="this.style.background=\'rgba(255,255,255,0.02)\'">' +
          '<input type="checkbox" id="gear-' + i + '" style="margin-top:3px; accent-color:var(--accent-primary); width:18px; height:18px; flex-shrink:0;">' +
          '<span style="font-size:var(--text-sm); color:var(--text-secondary); line-height:1.5;">' + item + '</span></label>';
      }).join('');
    }

    // ============================================================
    // Result Actions
    // ============================================================
    function initResultActions() {
      // Share
      var shareBtn = document.getElementById('rb-share-btn');
      if (shareBtn) {
        shareBtn.addEventListener('click', function() {
          var summary = buildShareText();
          if (navigator.share) {
            navigator.share({
              title: 'My Night Route Strategy â€” RunSafeTonight',
              text: summary,
              url: window.location.href
            }).catch(function() {});
          } else if (navigator.clipboard) {
            navigator.clipboard.writeText(summary).then(function() {
              showToast('Route plan copied to clipboard! Share it with a friend.');
            });
          } else {
            showToast('Share your plan with a trusted contact before heading out.');
          }
        });
      }

      // Download
      var downloadBtn = document.getElementById('rb-download-btn');
      if (downloadBtn) {
        downloadBtn.addEventListener('click', function() {
          downloadChecklist();
        });
      }

      // Restart
      var restartBtn = document.getElementById('rb-restart-btn');
      if (restartBtn) {
        restartBtn.addEventListener('click', function() {
          resetTool();
        });
      }
    }

    function buildShareText() {
      var envNames = { urban: 'Urban Core', suburban: 'Suburban Loop', campus: 'Campus', park: 'Park Trail', waterfront: 'Waterfront', travel: 'Travel / Hotel' };
      var comfortNames = { busy: 'Prefer busy streets', mixed: 'Mixed', quiet: 'Prefer quiet routes' };
      var lightNames = { 'well-lit': 'Well-lit only', 'some-dark': 'Some dark stretches OK', 'own-light': 'I bring my own light' };
      var timeNames = { 'before-sunset': 'Before sunset', 'dusk': 'Sunset/dusk', 'early-evening': 'Early evening (6-9 PM)', 'late-evening': 'Late evening (9 PM-midnight)', 'after-midnight': 'After midnight' };

      return 'My Night Run Plan (RunSafeTonight.com)\n' +
        '---\n' +
        'Distance: ' + state.distance + ' miles\n' +
        'Environment: ' + (envNames[state.environment] || state.environment) + '\n' +
        'Comfort: ' + (comfortNames[state.comfort] || state.comfort) + '\n' +
        'Lighting: ' + (lightNames[state.lighting] || state.lighting) + '\n' +
        'Time: ' + (timeNames[state.time] || state.time) + '\n' +
        'Confidence Score: ' + calculateConfidence() + '/100\n' +
        '---\n' +
        'Build your own: https://runsafetonight.com/route-builder/';
    }

    function downloadChecklist() {
      var envNames = { urban: 'Urban Core', suburban: 'Suburban Loop', campus: 'Campus', park: 'Park Trail', waterfront: 'Waterfront', travel: 'Travel / Hotel' };
      var checkboxes = document.querySelectorAll('#rb-gear-checklist input[type="checkbox"]');
      var items = [];
      checkboxes.forEach(function(cb) {
        var label = cb.parentElement.querySelector('span');
        items.push((cb.checked ? '[x] ' : '[ ] ') + (label ? label.textContent : ''));
      });

      var text = 'NIGHT RUN PRE-RUN CHECKLIST\n';
      text += 'Generated by RunSafeTonight.com Night Route Builder\n';
      text += '================================================\n\n';
      text += 'ROUTE PROFILE:\n';
      text += '  Distance: ' + state.distance + ' miles\n';
      text += '  Environment: ' + (envNames[state.environment] || state.environment) + '\n';
      text += '  Time: ' + (state.time || 'Not set') + '\n';
      text += '  Confidence Score: ' + calculateConfidence() + '/100\n\n';
      text += 'GEAR CHECKLIST:\n';
      items.forEach(function(item) { text += '  ' + item + '\n'; });
      text += '\nPRE-RUN REMINDERS:\n';
      text += '  [ ] Route shared with trusted contact\n';
      text += '  [ ] Phone fully charged\n';
      text += '  [ ] Location sharing enabled\n';
      text += '  [ ] Estimated return time communicated\n';
      text += '  [ ] Weather checked\n';
      text += '  [ ] Bail-out points identified\n\n';
      text += 'POST-RUN:\n';
      text += '  [ ] Check in with safety contact\n';
      text += '  [ ] Note any route issues for next time\n';
      text += '  [ ] Log your run\n\n';
      text += '---\n';
      text += 'The night belongs to you. Run confident.\n';
      text += 'https://runsafetonight.com/route-builder/\n';

      var blob = new Blob([text], { type: 'text/plain' });
      var url = URL.createObjectURL(blob);
      var a = document.createElement('a');
      a.href = url;
      a.download = 'night-run-checklist.txt';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);

      showToast('Checklist downloaded! Review it before your run.');
    }

    function resetTool() {
      state = { step: 1, distance: 5, environment: null, comfort: null, surface: null, lighting: null, time: null };

      // Show steps, hide results
      var stepsContainer = document.getElementById('rb-steps-container');
      var progressSection = document.getElementById('rb-progress-section');
      var results = document.getElementById('rb-results');
      if (stepsContainer) stepsContainer.style.display = 'block';
      if (progressSection) progressSection.style.display = 'block';
      if (results) results.style.display = 'none';

      // Reset slider
      var slider = document.getElementById('rb-distance-slider');
      if (slider) slider.value = 5;
      var display = document.getElementById('rb-distance-display');
      if (display) display.textContent = '5';

      // Reset all selections
      document.querySelectorAll('.rb-option-card, .rb-option-btn').forEach(function(el) {
        el.classList.remove('selected');
      });

      // Disable next buttons
      document.querySelectorAll('.rb-next-btn, .rb-generate-btn').forEach(function(btn) {
        if (btn.closest('.rb-step[data-step="1"]')) return; // Step 1 has no selection requirement
        btn.disabled = true;
        btn.style.opacity = '0.5';
      });

      // Reset checkboxes
      document.querySelectorAll('#rb-gear-checklist input[type="checkbox"]').forEach(function(cb) {
        cb.checked = false;
      });

      goToStep(1);
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // ============================================================
    // Utility
    // ============================================================
    function showToast(message) {
      var toast = document.getElementById('toast');
      if (!toast) return;
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(function() { toast.classList.remove('show'); }, 4000);
    }

    function initScrollAnimationsForResults() {
      var elements = document.querySelectorAll('#rb-results .fade-in');
      if (!elements.length) return;
      var observer = new IntersectionObserver(function(entries) {
        entries.forEach(function(entry) {
          if (entry.isIntersecting) {
            entry.target.classList.add('visible');
            observer.unobserve(entry.target);
          }
        });
      }, { threshold: 0.1, rootMargin: '0px 0px -50px 0px' });
      elements.forEach(function(el) { observer.observe(el); });
    }

  })();
  </script>

  <!-- ====== PAGE-SPECIFIC STYLES ====== -->
  <style>
    /* Option Cards (Step 2) */
    .rb-option-card {
      background: var(--bg-card);
      border: 2px solid var(--border-subtle);
      border-radius: var(--radius-lg);
      padding: var(--space-xl);
      text-align: center;
      cursor: pointer;
      transition: all var(--transition-base);
      display: flex;
      flex-direction: column;
      align-items: center;
      color: var(--text-primary);
      font-family: inherit;
      font-size: inherit;
    }

    .rb-option-card:hover {
      border-color: var(--border-accent);
      background: rgba(0, 212, 255, 0.05);
      transform: translateY(-2px);
    }

    .rb-option-card.selected {
      border-color: var(--accent-primary);
      background: rgba(0, 212, 255, 0.1);
      box-shadow: 0 0 20px rgba(0, 212, 255, 0.15);
    }

    /* Option Buttons (Steps 3-6) */
    .rb-option-btn {
      display: flex;
      align-items: flex-start;
      gap: var(--space-md);
      padding: var(--space-lg) var(--space-xl);
      background: var(--bg-card);
      border: 2px solid var(--border-subtle);
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: all var(--transition-base);
      text-align: left;
      width: 100%;
      color: var(--text-primary);
      font-family: inherit;
      font-size: inherit;
    }

    .rb-option-btn:hover {
      border-color: var(--border-accent);
      background: rgba(0, 212, 255, 0.05);
      transform: translateX(4px);
    }

    .rb-option-btn.selected {
      border-color: var(--accent-primary);
      background: rgba(0, 212, 255, 0.1);
      box-shadow: 0 0 20px rgba(0, 212, 255, 0.15);
    }

    /* Step transitions */
    .rb-step {
      transition: opacity 0.4s ease, transform 0.4s ease;
    }

    /* Mobile responsive for option cards */
    @media (max-width: 480px) {
      .rb-option-card {
        padding: var(--space-lg);
      }

      #rb-step-2 > div:nth-child(2) {
        grid-template-columns: 1fr;
      }
    }
  </style>

</body>
</html>
