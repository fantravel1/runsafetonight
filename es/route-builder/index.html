<!DOCTYPE html>
<html lang="es" dir="ltr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <!-- Primary SEO -->
  <title>Constructor de Rutas Nocturnas â€” Planifica Tu Carrera Nocturna | RunSafeTonight</title>
  <meta name="description" content="Construye una estrategia personalizada de ruta nocturna para correr en 60 segundos. Elige tu distancia, entorno, nivel de comodidad y obtÃ©n un plan adaptado con lista de equipamiento y consejos de seguridad.">
  <meta name="keywords" content="planificador de rutas nocturnas, planificar carrera nocturna, constructor de rutas seguras, herramienta de rutas para correr de noche, estrategia de rutas nocturnas, planificador de seguridad para corredores nocturnos">
  <meta name="author" content="RunSafeTonight">
  <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
  <link rel="canonical" href="https://runsafetonight.com/es/route-builder/">

  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://runsafetonight.com/es/route-builder/">
  <meta property="og:title" content="Constructor de Rutas Nocturnas â€” Planifica Tu Carrera Nocturna">
  <meta property="og:description" content="Construye una estrategia personalizada de ruta nocturna en 60 segundos. Distancia, entorno, comodidad, iluminaciÃ³n â€” todo adaptado a tu carrera.">
  <meta property="og:image" content="https://images.unsplash.com/photo-1552674605-db6ffd4facb5?w=1200&h=630&fit=crop">
  <meta property="og:site_name" content="RunSafeTonight">
  <meta property="og:locale" content="es_ES">
  <meta property="og:locale:alternate" content="en_US">

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Constructor de Rutas Nocturnas â€” Planifica Tu Carrera Nocturna">
  <meta name="twitter:description" content="Construye una estrategia personalizada de ruta nocturna en 60 segundos.">
  <meta name="twitter:image" content="https://images.unsplash.com/photo-1552674605-db6ffd4facb5?w=1200&h=630&fit=crop">

  <!-- Alternate language -->
  <link rel="alternate" hreflang="en" href="https://runsafetonight.com/route-builder/">
  <link rel="alternate" hreflang="es" href="https://runsafetonight.com/es/route-builder/">
  <link rel="alternate" hreflang="x-default" href="https://runsafetonight.com/route-builder/">

  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸƒ</text></svg>">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">

  <!-- Styles -->
  <link rel="stylesheet" href="../../css/style.css">

  <!-- Schema.org Structured Data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "SoftwareApplication",
    "name": "Constructor de Rutas Nocturnas",
    "description": "Una herramienta interactiva que ayuda a los corredores nocturnos a construir estrategias personalizadas de ruta basadas en distancia, entorno, nivel de comodidad, preferencia de superficie, necesidades de iluminaciÃ³n y ventana horaria.",
    "url": "https://runsafetonight.com/es/route-builder/",
    "applicationCategory": "HealthApplication",
    "operatingSystem": "Web",
    "offers": {
      "@type": "Offer",
      "price": "0",
      "priceCurrency": "USD"
    },
    "creator": {
      "@type": "Organization",
      "name": "RunSafeTonight",
      "url": "https://runsafetonight.com"
    },
    "inLanguage": ["es", "en"],
    "featureList": [
      "GeneraciÃ³n personalizada de estrategia de ruta",
      "PlanificaciÃ³n de distancia de 1 a 25 km",
      "OrientaciÃ³n especÃ­fica por entorno",
      "Generador de lista de equipamiento",
      "Planes de carrera compartibles",
      "Lista de verificaciÃ³n previa descargable"
    ]
  }
  </script>
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      {
        "@type": "ListItem",
        "position": 1,
        "name": "Inicio",
        "item": "https://runsafetonight.com/es/"
      },
      {
        "@type": "ListItem",
        "position": 2,
        "name": "Constructor de Rutas Nocturnas",
        "item": "https://runsafetonight.com/es/route-builder/"
      }
    ]
  }
  </script>
</head>
<body>

  <!-- ====== HEADER ====== -->
  <header class="site-header" role="banner">
    <div class="header-inner">
      <a href="/es/" class="logo" aria-label="RunSafeTonight Inicio">
        <div class="logo-icon">ğŸƒ</div>
        <span>RunSafe<strong>Tonight</strong></span>
      </a>

      <nav class="main-nav" role="navigation" aria-label="NavegaciÃ³n principal">
        <a href="/es/#conditions">Esta Noche</a>
        <a href="/es/#environments">Entornos</a>
        <a href="/es/#strategy">Estrategia</a>
        <a href="/es/guides/">GuÃ­as</a>
        <a href="/es/route-builder/" aria-current="page">Constructor de Rutas</a>
        <a href="/es/#community">Comunidad</a>
      </nav>

      <div class="header-actions">
        <div class="lang-switch" role="navigation" aria-label="Selector de idioma">
          <a href="/route-builder/" aria-label="English">EN</a>
          <a href="/es/route-builder/" class="active" aria-label="EspaÃ±ol">ES</a>
        </div>
        <button class="hamburger" aria-label="Abrir menÃº" aria-expanded="false" aria-controls="mobile-nav">
          <span></span>
          <span></span>
          <span></span>
        </button>
      </div>
    </div>
  </header>

  <!-- ====== MOBILE NAV ====== -->
  <nav class="mobile-nav" id="mobile-nav" role="navigation" aria-label="NavegaciÃ³n mÃ³vil" aria-hidden="true">
    <a href="/es/#conditions">Condiciones de Esta Noche</a>
    <a href="/es/#environments">Entornos</a>
    <a href="/es/#strategy">Sistema de Estrategia Nocturna</a>
    <a href="/es/guides/">GuÃ­as y Base de Datos</a>
    <a href="/es/route-builder/" aria-current="page">Constructor de Rutas Nocturnas</a>
    <a href="/es/#community">Comunidad</a>
    <div class="mobile-nav-cta">
      <a href="/es/#nightcrew" class="btn btn--primary btn--lg" style="width:100%;text-align:center;">Ãšnete al Night Crew</a>
    </div>
  </nav>

  <main>
    <!-- ====== PAGE HERO ====== -->
    <section class="page-hero" aria-labelledby="page-title">
      <div class="page-hero-bg">
        <img src="https://images.unsplash.com/photo-1486218119243-13883505764c?w=1920&q=80" alt="Corredor en una carretera al atardecer en transiciÃ³n hacia la noche" width="1920" height="800" loading="eager">
      </div>
      <div class="container">
        <div class="page-hero-content">
          <nav class="breadcrumb" aria-label="Migas de pan">
            <a href="/es/">Inicio</a>
            <span class="breadcrumb-sep">/</span>
            <span aria-current="page">Constructor de Rutas Nocturnas</span>
          </nav>
          <span class="section-label">Herramienta Interactiva</span>
          <h1 class="page-title" id="page-title">Constructor de Rutas <span class="text-gradient">Nocturnas</span></h1>
          <p class="page-subtitle">Construye una estrategia personalizada de ruta nocturna en 6 simples pasos. ObtÃ©n orientaciÃ³n adaptada, una lista de equipamiento y un plan compartible.</p>
        </div>
      </div>
    </section>

    <!-- ====== ROUTE BUILDER TOOL ====== -->
    <section class="section" id="route-builder-tool" aria-labelledby="tool-title">
      <div class="container container--narrow">

        <!-- Progress Indicator -->
        <div class="fade-in" id="rb-progress-section" style="margin-bottom: var(--space-2xl);">
          <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: var(--space-md);">
            <h2 class="sr-only" id="tool-title">Pasos del Constructor de Rutas</h2>
            <span style="font-size:var(--text-sm); font-weight:600; color:var(--text-secondary);">Paso <span id="rb-step-current">1</span> de 6</span>
            <span style="font-size:var(--text-sm); font-weight:600; color:var(--accent-primary);" id="rb-step-percent">17%</span>
          </div>
          <div class="progress-bar">
            <div class="progress-bar-fill" id="rb-progress-bar" style="width:17%;"></div>
          </div>
          <!-- Step labels -->
          <div style="display:flex; justify-content:space-between; margin-top:var(--space-sm); gap:var(--space-xs);" id="rb-step-dots">
            <button class="rb-dot active" data-step="1" style="flex:1;height:4px;border-radius:2px;background:var(--accent-primary);border:none;cursor:pointer;transition:background var(--transition-fast);" aria-label="Ir al Paso 1"></button>
            <button class="rb-dot" data-step="2" style="flex:1;height:4px;border-radius:2px;background:rgba(255,255,255,0.1);border:none;cursor:pointer;transition:background var(--transition-fast);" aria-label="Ir al Paso 2"></button>
            <button class="rb-dot" data-step="3" style="flex:1;height:4px;border-radius:2px;background:rgba(255,255,255,0.1);border:none;cursor:pointer;transition:background var(--transition-fast);" aria-label="Ir al Paso 3"></button>
            <button class="rb-dot" data-step="4" style="flex:1;height:4px;border-radius:2px;background:rgba(255,255,255,0.1);border:none;cursor:pointer;transition:background var(--transition-fast);" aria-label="Ir al Paso 4"></button>
            <button class="rb-dot" data-step="5" style="flex:1;height:4px;border-radius:2px;background:rgba(255,255,255,0.1);border:none;cursor:pointer;transition:background var(--transition-fast);" aria-label="Ir al Paso 5"></button>
            <button class="rb-dot" data-step="6" style="flex:1;height:4px;border-radius:2px;background:rgba(255,255,255,0.1);border:none;cursor:pointer;transition:background var(--transition-fast);" aria-label="Ir al Paso 6"></button>
          </div>
        </div>

        <!-- Steps Container -->
        <div class="route-builder fade-in" id="rb-steps-container">

          <!-- PASO 1: Distancia -->
          <div class="rb-step active" data-step="1" id="rb-step-1">
            <div style="text-align:center; margin-bottom:var(--space-xl);">
              <div style="font-size:48px; margin-bottom:var(--space-md);">ğŸ“</div>
              <h3 style="font-size:var(--text-2xl); font-weight:800; margin-bottom:var(--space-sm);">Â¿QuÃ© distancia quieres correr?</h3>
              <p style="color:var(--text-secondary); font-size:var(--text-sm);">Desliza para elegir tu distancia.</p>
            </div>
            <div style="padding:0 var(--space-lg);">
              <div style="text-align:center; margin-bottom:var(--space-xl);">
                <span id="rb-distance-display" style="font-size:var(--text-6xl); font-weight:900; background:var(--gradient-accent); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; line-height:1;">8</span>
                <span style="font-size:var(--text-xl); color:var(--text-secondary); margin-left:var(--space-sm);">km</span>
              </div>
              <input type="range" class="form-range" id="rb-distance-slider" min="2" max="25" value="8" step="1" aria-label="Distancia en kilÃ³metros">
              <div style="display:flex; justify-content:space-between; margin-top:var(--space-sm); font-size:var(--text-xs); color:var(--text-muted);">
                <span>2 km</span>
                <span>8 km</span>
                <span>16 km</span>
                <span>25 km</span>
              </div>
              <div id="rb-distance-label" style="text-align:center; margin-top:var(--space-lg); padding:var(--space-md); background:rgba(0,212,255,0.05); border-radius:var(--radius-md); border:1px solid rgba(0,212,255,0.1); font-size:var(--text-sm); color:var(--text-secondary);">
                Distancia media â€” una carrera nocturna sÃ³lida para ganar confianza.
              </div>
            </div>
            <div style="text-align:center; margin-top:var(--space-2xl);">
              <button class="btn btn--primary btn--lg rb-next-btn" data-next="2">Siguiente: Entorno â†’</button>
            </div>
          </div>

          <!-- PASO 2: Tipo de Entorno -->
          <div class="rb-step" data-step="2" id="rb-step-2" style="display:none;">
            <div style="text-align:center; margin-bottom:var(--space-xl);">
              <div style="font-size:48px; margin-bottom:var(--space-md);">ğŸŒ</div>
              <h3 style="font-size:var(--text-2xl); font-weight:800; margin-bottom:var(--space-sm);">Â¿CuÃ¡l es tu entorno de carrera?</h3>
              <p style="color:var(--text-secondary); font-size:var(--text-sm);">Elige el tipo que mejor describe dÃ³nde correrÃ¡s esta noche.</p>
            </div>
            <div style="display:grid; grid-template-columns:repeat(2,1fr); gap:var(--space-md);">
              <button class="rb-option-card" data-value="urban" aria-label="Centro Urbano">
                <div style="font-size:32px; margin-bottom:var(--space-sm);">ğŸ™ï¸</div>
                <div style="font-weight:700; margin-bottom:var(--space-xs);">Centro Urbano</div>
                <div style="font-size:var(--text-xs); color:var(--text-muted);">Calles de ciudad, corredores comerciales, alumbrado pÃºblico</div>
              </button>
              <button class="rb-option-card" data-value="suburban" aria-label="Circuito Suburbano">
                <div style="font-size:32px; margin-bottom:var(--space-sm);">ğŸ˜ï¸</div>
                <div style="font-weight:700; margin-bottom:var(--space-xs);">Circuito Suburbano</div>
                <div style="font-size:var(--text-xs); color:var(--text-muted);">Vecindarios, aceras, calles residenciales</div>
              </button>
              <button class="rb-option-card" data-value="campus" aria-label="Campus">
                <div style="font-size:32px; margin-bottom:var(--space-sm);">ğŸ“</div>
                <div style="font-weight:700; margin-bottom:var(--space-xs);">Campus</div>
                <div style="font-size:var(--text-xs); color:var(--text-muted);">Caminos universitarios, postes de emergencia, patios</div>
              </button>
              <button class="rb-option-card" data-value="park" aria-label="Sendero de Parque">
                <div style="font-size:32px; margin-bottom:var(--space-sm);">ğŸŒ³</div>
                <div style="font-weight:700; margin-bottom:var(--space-xs);">Sendero de Parque</div>
                <div style="font-size:var(--text-xs); color:var(--text-muted);">Parques, senderos, superficies naturales</div>
              </button>
              <button class="rb-option-card" data-value="waterfront" aria-label="Costanera">
                <div style="font-size:32px; margin-bottom:var(--space-sm);">ğŸŒŠ</div>
                <div style="font-weight:700; margin-bottom:var(--space-xs);">Costanera</div>
                <div style="font-size:var(--text-xs); color:var(--text-muted);">Caminos costeros, paseos marÃ­timos, senderos lacustres</div>
              </button>
              <button class="rb-option-card" data-value="travel" aria-label="Viaje / Hotel">
                <div style="font-size:32px; margin-bottom:var(--space-sm);">âœˆï¸</div>
                <div style="font-weight:700; margin-bottom:var(--space-xs);">Viaje</div>
                <div style="font-size:var(--text-xs); color:var(--text-muted);">Ciudad nueva, radio del hotel, zona desconocida</div>
              </button>
            </div>
            <div style="display:flex; justify-content:space-between; margin-top:var(--space-2xl); gap:var(--space-md);">
              <button class="btn btn--secondary rb-prev-btn" data-prev="1">â† AtrÃ¡s</button>
              <button class="btn btn--primary rb-next-btn" data-next="3" id="rb-env-next" disabled style="opacity:0.5;">Siguiente: Comodidad â†’</button>
            </div>
          </div>

          <!-- PASO 3: Nivel de Comodidad -->
          <div class="rb-step" data-step="3" id="rb-step-3" style="display:none;">
            <div style="text-align:center; margin-bottom:var(--space-xl);">
              <div style="font-size:48px; margin-bottom:var(--space-md);">ğŸ›¡ï¸</div>
              <h3 style="font-size:var(--text-2xl); font-weight:800; margin-bottom:var(--space-sm);">Â¿CuÃ¡l es tu nivel de comodidad?</h3>
              <p style="color:var(--text-secondary); font-size:var(--text-sm);">Â¿CÃ³mo te sientes respecto a la actividad en las calles durante tu carrera?</p>
            </div>
            <div style="display:flex; flex-direction:column; gap:var(--space-md);">
              <button class="rb-option-btn" data-value="busy">
                <span style="font-size:20px; flex-shrink:0;">ğŸš¦</span>
                <div>
                  <div style="font-weight:700;">Prefiero Calles Concurridas</div>
                  <div style="font-size:var(--text-xs); color:var(--text-muted);">MÃ¡s personas, mÃ¡s luces, mÃ¡s actividad a mi alrededor</div>
                </div>
              </button>
              <button class="rb-option-btn" data-value="mixed">
                <span style="font-size:20px; flex-shrink:0;">âš–ï¸</span>
                <div>
                  <div style="font-weight:700;">Mezcla EstÃ¡ Bien</div>
                  <div style="font-size:var(--text-xs); color:var(--text-muted);">Una combinaciÃ³n de corredores concurridos y tramos mÃ¡s tranquilos</div>
                </div>
              </button>
              <button class="rb-option-btn" data-value="quiet">
                <span style="font-size:20px; flex-shrink:0;">ğŸŒ™</span>
                <div>
                  <div style="font-weight:700;">Prefiero Rutas Tranquilas</div>
                  <div style="font-size:var(--text-xs); color:var(--text-muted);">Menos personas, mÃ¡s soledad, carrera tranquila</div>
                </div>
              </button>
            </div>
            <div style="display:flex; justify-content:space-between; margin-top:var(--space-2xl); gap:var(--space-md);">
              <button class="btn btn--secondary rb-prev-btn" data-prev="2">â† AtrÃ¡s</button>
              <button class="btn btn--primary rb-next-btn" data-next="4" disabled style="opacity:0.5;">Siguiente: Superficie â†’</button>
            </div>
          </div>

          <!-- PASO 4: Preferencia de Superficie -->
          <div class="rb-step" data-step="4" id="rb-step-4" style="display:none;">
            <div style="text-align:center; margin-bottom:var(--space-xl);">
              <div style="font-size:48px; margin-bottom:var(--space-md);">ğŸ‘Ÿ</div>
              <h3 style="font-size:var(--text-2xl); font-weight:800; margin-bottom:var(--space-sm);">Â¿QuÃ© superficies te funcionan?</h3>
              <p style="color:var(--text-secondary); font-size:var(--text-sm);">La superficie afecta el agarre, la visibilidad y la elecciÃ³n de calzado de noche.</p>
            </div>
            <div style="display:flex; flex-direction:column; gap:var(--space-md);">
              <button class="rb-option-btn" data-value="paved">
                <span style="font-size:20px; flex-shrink:0;">ğŸ›¤ï¸</span>
                <div>
                  <div style="font-weight:700;">Solo Pavimentado</div>
                  <div style="font-size:var(--text-xs); color:var(--text-muted);">Aceras, asfalto, caminos de concreto Ãºnicamente</div>
                </div>
              </button>
              <button class="rb-option-btn" data-value="mixed-surface">
                <span style="font-size:20px; flex-shrink:0;">ğŸ”€</span>
                <div>
                  <div style="font-weight:700;">Superficies Mixtas OK</div>
                  <div style="font-size:var(--text-xs); color:var(--text-muted);">Algo de grava, tierra compactada o piedra triturada estÃ¡ bien</div>
                </div>
              </button>
              <button class="rb-option-btn" data-value="trail-ok">
                <span style="font-size:20px; flex-shrink:0;">ğŸ¥¾</span>
                <div>
                  <div style="font-weight:700;">Sendero OK</div>
                  <div style="font-size:var(--text-xs); color:var(--text-muted);">Me siento cÃ³modo en superficies naturales de sendero por la noche</div>
                </div>
              </button>
            </div>
            <div style="display:flex; justify-content:space-between; margin-top:var(--space-2xl); gap:var(--space-md);">
              <button class="btn btn--secondary rb-prev-btn" data-prev="3">â† AtrÃ¡s</button>
              <button class="btn btn--primary rb-next-btn" data-next="5" disabled style="opacity:0.5;">Siguiente: IluminaciÃ³n â†’</button>
            </div>
          </div>

          <!-- PASO 5: Preferencia de IluminaciÃ³n -->
          <div class="rb-step" data-step="5" id="rb-step-5" style="display:none;">
            <div style="text-align:center; margin-bottom:var(--space-xl);">
              <div style="font-size:48px; margin-bottom:var(--space-md);">ğŸ’¡</div>
              <h3 style="font-size:var(--text-2xl); font-weight:800; margin-bottom:var(--space-sm);">Â¿CuÃ¡l es tu preferencia de iluminaciÃ³n?</h3>
              <p style="color:var(--text-secondary); font-size:var(--text-sm);">Â¿CuÃ¡nta luz ambiental necesitas a lo largo de tu ruta?</p>
            </div>
            <div style="display:flex; flex-direction:column; gap:var(--space-md);">
              <button class="rb-option-btn" data-value="well-lit">
                <span style="font-size:20px; flex-shrink:0;">ğŸ”†</span>
                <div>
                  <div style="font-weight:700;">Solo Bien Iluminado</div>
                  <div style="font-size:var(--text-xs); color:var(--text-muted);">Alumbrado pÃºblico consistente, sin tramos oscuros</div>
                </div>
              </button>
              <button class="rb-option-btn" data-value="some-dark">
                <span style="font-size:20px; flex-shrink:0;">ğŸŒ“</span>
                <div>
                  <div style="font-weight:700;">Algunos Tramos Oscuros OK</div>
                  <div style="font-size:var(--text-xs); color:var(--text-muted);">Mayormente iluminado, pero puedo manejar secciones oscuras breves</div>
                </div>
              </button>
              <button class="rb-option-btn" data-value="own-light">
                <span style="font-size:20px; flex-shrink:0;">ğŸ”¦</span>
                <div>
                  <div style="font-weight:700;">Llevo Mi Propia Luz</div>
                  <div style="font-size:var(--text-xs); color:var(--text-muted);">Linterna frontal o de cintura â€” no dependo del alumbrado pÃºblico</div>
                </div>
              </button>
            </div>
            <div style="display:flex; justify-content:space-between; margin-top:var(--space-2xl); gap:var(--space-md);">
              <button class="btn btn--secondary rb-prev-btn" data-prev="4">â† AtrÃ¡s</button>
              <button class="btn btn--primary rb-next-btn" data-next="6" disabled style="opacity:0.5;">Siguiente: Horario â†’</button>
            </div>
          </div>

          <!-- PASO 6: Ventana Horaria -->
          <div class="rb-step" data-step="6" id="rb-step-6" style="display:none;">
            <div style="text-align:center; margin-bottom:var(--space-xl);">
              <div style="font-size:48px; margin-bottom:var(--space-md);">ğŸ•</div>
              <h3 style="font-size:var(--text-2xl); font-weight:800; margin-bottom:var(--space-sm);">Â¿CuÃ¡ndo vas a correr?</h3>
              <p style="color:var(--text-secondary); font-size:var(--text-sm);">La hora de la noche lo cambia todo â€” trÃ¡fico, iluminaciÃ³n y actividad en las calles.</p>
            </div>
            <div style="display:flex; flex-direction:column; gap:var(--space-md);">
              <button class="rb-option-btn" data-value="before-sunset">
                <span style="font-size:20px; flex-shrink:0;">ğŸŒ…</span>
                <div>
                  <div style="font-weight:700;">Antes del Atardecer</div>
                  <div style="font-size:var(--text-xs); color:var(--text-muted);">Empezando con luz natural, puede terminar al anochecer</div>
                </div>
              </button>
              <button class="rb-option-btn" data-value="dusk">
                <span style="font-size:20px; flex-shrink:0;">ğŸŒ†</span>
                <div>
                  <div style="font-weight:700;">Atardecer / CrepÃºsculo</div>
                  <div style="font-size:var(--text-xs); color:var(--text-muted);">La hora dorada de transiciÃ³n hacia la oscuridad</div>
                </div>
              </button>
              <button class="rb-option-btn" data-value="early-evening">
                <span style="font-size:20px; flex-shrink:0;">ğŸŒƒ</span>
                <div>
                  <div style="font-weight:700;">Primera Noche (18-21h)</div>
                  <div style="font-size:var(--text-xs); color:var(--text-muted);">DespuÃ©s de cenar, calles aÃºn activas</div>
                </div>
              </button>
              <button class="rb-option-btn" data-value="late-evening">
                <span style="font-size:20px; flex-shrink:0;">ğŸŒ™</span>
                <div>
                  <div style="font-weight:700;">Noche Avanzada (21h - Medianoche)</div>
                  <div style="font-size:var(--text-xs); color:var(--text-muted);">Calles calmÃ¡ndose, menos peatones</div>
                </div>
              </button>
              <button class="rb-option-btn" data-value="after-midnight">
                <span style="font-size:20px; flex-shrink:0;">ğŸŒ‘</span>
                <div>
                  <div style="font-weight:700;">DespuÃ©s de Medianoche</div>
                  <div style="font-size:var(--text-xs); color:var(--text-muted);">Noche profunda, actividad callejera mÃ­nima</div>
                </div>
              </button>
            </div>
            <div style="display:flex; justify-content:space-between; margin-top:var(--space-2xl); gap:var(--space-md);">
              <button class="btn btn--secondary rb-prev-btn" data-prev="5">â† AtrÃ¡s</button>
              <button class="btn btn--primary btn--lg rb-generate-btn" disabled style="opacity:0.5;">Generar Mi Estrategia de Ruta</button>
            </div>
          </div>

        </div><!-- /rb-steps-container -->

        <!-- ====== RESULTADOS GENERADOS ====== -->
        <div id="rb-results" style="display:none;" class="fade-in">

          <!-- PuntuaciÃ³n de Confianza -->
          <div class="route-builder" style="text-align:center; margin-bottom:var(--space-2xl);">
            <div style="font-size:var(--text-sm); font-weight:700; text-transform:uppercase; letter-spacing:0.1em; color:var(--accent-primary); margin-bottom:var(--space-md);">Tu Estrategia de Ruta</div>
            <div style="font-size:var(--text-7xl); font-weight:900; line-height:1; margin-bottom:var(--space-sm);">
              <span class="text-gradient" id="rb-confidence-score">0</span>
            </div>
            <div style="font-size:var(--text-xl); font-weight:700; margin-bottom:var(--space-sm);">PuntuaciÃ³n de Confianza</div>
            <div id="rb-score-label" style="font-size:var(--text-sm); color:var(--text-secondary); max-width:500px; margin:0 auto;"></div>
            <div style="margin-top:var(--space-lg);">
              <div class="progress-bar" style="max-width:300px; margin:0 auto; height:8px;">
                <div class="progress-bar-fill" id="rb-score-bar" style="width:0%; transition:width 1.5s ease;"></div>
              </div>
            </div>
          </div>

          <!-- OrientaciÃ³n de DiseÃ±o de Ruta -->
          <div class="route-builder" style="margin-bottom:var(--space-2xl);">
            <h3 style="font-size:var(--text-xl); font-weight:800; margin-bottom:var(--space-lg); display:flex; align-items:center; gap:var(--space-sm);">
              <span style="font-size:24px;">ğŸ—ºï¸</span> OrientaciÃ³n de DiseÃ±o de Ruta
            </h3>
            <div id="rb-route-design" style="display:flex; flex-direction:column; gap:var(--space-md);"></div>
          </div>

          <!-- Consejos EspecÃ­ficos del Entorno -->
          <div class="route-builder" style="margin-bottom:var(--space-2xl);">
            <h3 style="font-size:var(--text-xl); font-weight:800; margin-bottom:var(--space-lg); display:flex; align-items:center; gap:var(--space-sm);">
              <span style="font-size:24px;">ğŸ¯</span> Consejos EspecÃ­ficos del Entorno
            </h3>
            <div id="rb-env-tips" style="display:flex; flex-direction:column; gap:var(--space-md);"></div>
          </div>

          <!-- Lista de Equipamiento -->
          <div class="route-builder" style="margin-bottom:var(--space-2xl);">
            <h3 style="font-size:var(--text-xl); font-weight:800; margin-bottom:var(--space-lg); display:flex; align-items:center; gap:var(--space-sm);">
              <span style="font-size:24px;">ğŸ’</span> Lista de Equipamiento
            </h3>
            <p style="font-size:var(--text-sm); color:var(--text-secondary); margin-bottom:var(--space-lg);">Marca los elementos mientras te preparas. Adaptada a tus selecciones.</p>
            <div id="rb-gear-checklist" style="display:flex; flex-direction:column; gap:var(--space-sm);"></div>
          </div>

          <!-- Botones de AcciÃ³n -->
          <div class="route-builder" style="margin-bottom:var(--space-2xl); text-align:center;">
            <h3 style="font-size:var(--text-xl); font-weight:800; margin-bottom:var(--space-lg);">Â¿Listo para Correr?</h3>
            <div style="display:flex; flex-wrap:wrap; justify-content:center; gap:var(--space-md);">
              <button class="btn btn--primary btn--lg" id="rb-share-btn">
                Compartir Tu Plan
              </button>
              <button class="btn btn--secondary btn--lg" id="rb-download-btn">
                Descargar Lista
              </button>
              <button class="btn btn--secondary" id="rb-restart-btn">
                Empezar de Nuevo
              </button>
            </div>
          </div>

          <!-- Pilares de Estrategia Relacionados -->
          <div style="margin-bottom:var(--space-2xl);">
            <h3 style="font-size:var(--text-xl); font-weight:800; margin-bottom:var(--space-lg); text-align:center;">Profundiza Tu Estrategia</h3>
            <div class="strategy-grid stagger-children" style="grid-template-columns:repeat(auto-fit, minmax(220px,1fr));">
              <a href="/es/strategy/route-intelligence.html" class="strategy-card fade-in">
                <div class="strategy-card-icon">ğŸ—ºï¸</div>
                <h3 class="strategy-card-title">Inteligencia de Ruta</h3>
                <p class="strategy-card-desc">DiseÃ±o de circuitos, puntos de salida, estrategia de tiempo y mapeo de zonas de confianza.</p>
              </a>
              <a href="/es/strategy/visual-presence.html" class="strategy-card fade-in">
                <div class="strategy-card-icon">ğŸ’¡</div>
                <h3 class="strategy-card-title">Presencia Visual</h3>
                <p class="strategy-card-desc">GeometrÃ­a reflectante, linterna frontal vs cintura, y colocaciÃ³n de alto contraste.</p>
              </a>
              <a href="/es/strategy/situational-awareness.html" class="strategy-card fade-in">
                <div class="strategy-card-icon">ğŸ‘ï¸</div>
                <h3 class="strategy-card-title">Conciencia Situacional</h3>
                <p class="strategy-card-desc">Ritmo de escaneo, protocolo de auriculares y calibraciÃ³n de intuiciÃ³n.</p>
              </a>
              <a href="/es/strategy/emotional-resilience.html" class="strategy-card fade-in">
                <div class="strategy-card-icon">ğŸ§ </div>
                <h3 class="strategy-card-title">Resiliencia Emocional</h3>
                <p class="strategy-card-desc">Reducir la fatiga de hipervigilancia, reinicios de respiraciÃ³n y construcciÃ³n de confianza.</p>
              </a>
              <a href="/es/strategy/community-safety.html" class="strategy-card fade-in">
                <div class="strategy-card-icon">ğŸ¤</div>
                <h3 class="strategy-card-title">Seguridad Comunitaria</h3>
                <p class="strategy-card-desc">Sistema de compaÃ±eros, compartir rutas y redes de rutas confiables.</p>
              </a>
            </div>
          </div>

        </div><!-- /rb-results -->

      </div>
    </section>
  </main>

  <!-- ====== FOOTER ====== -->
  <footer class="site-footer" role="contentinfo">
    <div class="container">
      <div class="footer-grid">
        <div class="footer-brand">
          <div class="footer-brand-logo">
            <span class="text-gradient">RunSafeTonight</span>
          </div>
          <p class="footer-brand-desc">La sede global para la libertad de correr de noche. Empoderando a corredores para ser dueÃ±os de la noche con estrategia, confianza y comunidad.</p>
        </div>

        <div>
          <h4 class="footer-col-title">Estrategia</h4>
          <div class="footer-links">
            <a href="/es/strategy/route-intelligence.html">Inteligencia de Ruta</a>
            <a href="/es/strategy/visual-presence.html">Presencia Visual</a>
            <a href="/es/strategy/situational-awareness.html">Conciencia Situacional</a>
            <a href="/es/strategy/emotional-resilience.html">Resiliencia Emocional</a>
            <a href="/es/strategy/community-safety.html">Seguridad Comunitaria</a>
          </div>
        </div>

        <div>
          <h4 class="footer-col-title">Entornos</h4>
          <div class="footer-links">
            <a href="/es/environments/urban-core.html">Centro Urbano</a>
            <a href="/es/environments/suburban-loop.html">Circuito Suburbano</a>
            <a href="/es/environments/campus.html">Campus</a>
            <a href="/es/environments/park-trail.html">Sendero de Parque</a>
            <a href="/es/environments/waterfront.html">Costanera</a>
            <a href="/es/environments/travel.html">Viaje / Hotel</a>
          </div>
        </div>

        <div>
          <h4 class="footer-col-title">Recursos</h4>
          <div class="footer-links">
            <a href="/es/guides/">Base de Datos de GuÃ­as</a>
            <a href="/es/route-builder/">Constructor de Rutas Nocturnas</a>
            <a href="/es/guides/#city-guides">GuÃ­as de Ciudades</a>
            <a href="/es/guides/#community-stories">Historias de la Comunidad</a>
            <a href="/es/#nightcrew">Ãšnete al Night Crew</a>
            <a href="/route-builder/">English Version</a>
          </div>
        </div>
      </div>

      <div class="footer-bottom">
        <p class="footer-bottom-text">&copy; 2026 RunSafeTonight.com â€” AdueÃ±ate de la Noche. Todos los derechos reservados.</p>
        <p class="footer-bottom-text" style="font-size: var(--text-xs);">AutonomÃ­a sobre el miedo. Empoderamiento primero. Siempre.</p>
      </div>
    </div>
  </footer>

  <!-- Volver Arriba -->
  <button class="back-to-top" aria-label="Volver arriba" id="back-to-top">â†‘</button>

  <!-- NotificaciÃ³n -->
  <div class="toast" id="toast" role="alert" aria-live="polite"></div>

  <!-- Global JS -->
  <script src="../../js/main.js"></script>

  <!-- ====== JS ESPECÃFICO DEL CONSTRUCTOR DE RUTAS ====== -->
  <script>
  (function() {
    'use strict';

    // ---- Estado ----
    var state = {
      step: 1,
      distance: 8,
      environment: null,
      comfort: null,
      surface: null,
      lighting: null,
      time: null
    };

    // ---- InicializaciÃ³n ----
    document.addEventListener('DOMContentLoaded', function() {
      initDistanceSlider();
      initOptionCards();
      initOptionButtons();
      initNavButtons();
      initStepDots();
      initGenerateButton();
      initResultActions();
    });

    // ============================================================
    // PASO 1: Control de Distancia
    // ============================================================
    function initDistanceSlider() {
      var slider = document.getElementById('rb-distance-slider');
      var display = document.getElementById('rb-distance-display');
      var label = document.getElementById('rb-distance-label');
      if (!slider) return;

      function updateDistance() {
        var val = parseInt(slider.value);
        state.distance = val;
        if (display) display.textContent = val;
        if (label) label.textContent = getDistanceLabel(val);
      }

      slider.addEventListener('input', updateDistance);
      updateDistance();
    }

    function getDistanceLabel(km) {
      if (km <= 3) return 'Carrera rÃ¡pida â€” perfecta para una primera carrera nocturna o mantenerse cerca de casa.';
      if (km <= 6) return 'Corta y directa â€” un gran constructor de confianza para correr de noche.';
      if (km <= 10) return 'Distancia media â€” una carrera nocturna sÃ³lida para ganar confianza.';
      if (km <= 13) return 'Entrando en territorio de carrera larga. AsegÃºrate de que tu ruta tenga puntos de salida.';
      if (km <= 16) return 'Distancia sÃ³lida. Planifica mÃºltiples circuitos con puntos de control bien iluminados.';
      if (km <= 20) return 'Carrera nocturna larga. HidrataciÃ³n, nutriciÃ³n y mÃºltiples puntos de seguridad son esenciales.';
      return 'Territorio ultra de noche. Esto requiere planificaciÃ³n avanzada y mÃºltiples capas de seguridad.';
    }

    // ============================================================
    // PASO 2: Tarjetas de Entorno
    // ============================================================
    function initOptionCards() {
      var cards = document.querySelectorAll('.rb-option-card');
      cards.forEach(function(card) {
        card.addEventListener('click', function() {
          var siblings = card.parentElement.querySelectorAll('.rb-option-card');
          siblings.forEach(function(s) { s.classList.remove('selected'); });
          card.classList.add('selected');

          state.environment = card.getAttribute('data-value');

          var nextBtn = card.closest('.rb-step').querySelector('.rb-next-btn');
          if (nextBtn) {
            nextBtn.disabled = false;
            nextBtn.style.opacity = '1';
          }
        });
      });
    }

    // ============================================================
    // PASOS 3-6: Botones de OpciÃ³n
    // ============================================================
    function initOptionButtons() {
      var allBtns = document.querySelectorAll('.rb-option-btn');
      allBtns.forEach(function(btn) {
        btn.addEventListener('click', function() {
          var step = btn.closest('.rb-step');
          var stepNum = parseInt(step.getAttribute('data-step'));

          step.querySelectorAll('.rb-option-btn').forEach(function(s) {
            s.classList.remove('selected');
          });
          btn.classList.add('selected');

          var val = btn.getAttribute('data-value');
          if (stepNum === 3) state.comfort = val;
          else if (stepNum === 4) state.surface = val;
          else if (stepNum === 5) state.lighting = val;
          else if (stepNum === 6) state.time = val;

          var nextBtn = step.querySelector('.rb-next-btn') || step.querySelector('.rb-generate-btn');
          if (nextBtn) {
            nextBtn.disabled = false;
            nextBtn.style.opacity = '1';
          }
        });
      });
    }

    // ============================================================
    // NavegaciÃ³n (Siguiente/Anterior)
    // ============================================================
    function initNavButtons() {
      document.querySelectorAll('.rb-next-btn').forEach(function(btn) {
        btn.addEventListener('click', function() {
          var next = parseInt(btn.getAttribute('data-next'));
          goToStep(next);
        });
      });

      document.querySelectorAll('.rb-prev-btn').forEach(function(btn) {
        btn.addEventListener('click', function() {
          var prev = parseInt(btn.getAttribute('data-prev'));
          goToStep(prev);
        });
      });
    }

    function initStepDots() {
      document.querySelectorAll('.rb-dot').forEach(function(dot) {
        dot.addEventListener('click', function() {
          var target = parseInt(dot.getAttribute('data-step'));
          if (target <= state.step) {
            goToStep(target);
          }
        });
      });
    }

    function goToStep(num) {
      document.querySelectorAll('.rb-step').forEach(function(s) {
        s.style.display = 'none';
        s.classList.remove('active');
      });

      var target = document.getElementById('rb-step-' + num);
      if (target) {
        target.style.display = 'block';
        target.style.opacity = '0';
        target.style.transform = 'translateY(20px)';
        requestAnimationFrame(function() {
          target.style.transition = 'opacity 0.4s ease, transform 0.4s ease';
          target.style.opacity = '1';
          target.style.transform = 'translateY(0)';
        });
        target.classList.add('active');
      }

      state.step = num;
      updateProgress(num);

      var container = document.getElementById('rb-steps-container');
      if (container) {
        var rect = container.getBoundingClientRect();
        if (rect.top < 0 || rect.top > window.innerHeight * 0.5) {
          window.scrollTo({
            top: container.offsetTop - 100,
            behavior: 'smooth'
          });
        }
      }
    }

    function updateProgress(step) {
      var pct = Math.round((step / 6) * 100);
      var bar = document.getElementById('rb-progress-bar');
      var num = document.getElementById('rb-step-current');
      var percent = document.getElementById('rb-step-percent');

      if (bar) bar.style.width = pct + '%';
      if (num) num.textContent = step;
      if (percent) percent.textContent = pct + '%';

      document.querySelectorAll('.rb-dot').forEach(function(dot) {
        var dotStep = parseInt(dot.getAttribute('data-step'));
        if (dotStep <= step) {
          dot.style.background = 'var(--accent-primary)';
        } else {
          dot.style.background = 'rgba(255,255,255,0.1)';
        }
      });
    }

    // ============================================================
    // Generar Resultados
    // ============================================================
    function initGenerateButton() {
      var btn = document.querySelector('.rb-generate-btn');
      if (!btn) return;

      btn.addEventListener('click', function() {
        if (btn.disabled) return;
        generateResults();
      });
    }

    function generateResults() {
      var stepsContainer = document.getElementById('rb-steps-container');
      var progressSection = document.getElementById('rb-progress-section');
      var results = document.getElementById('rb-results');

      if (stepsContainer) stepsContainer.style.display = 'none';
      if (progressSection) progressSection.style.display = 'none';
      if (results) {
        results.style.display = 'block';
        results.style.opacity = '0';
        results.style.transform = 'translateY(30px)';
        requestAnimationFrame(function() {
          results.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
          results.style.opacity = '1';
          results.style.transform = 'translateY(0)';
        });
      }

      window.scrollTo({ top: 0, behavior: 'smooth' });

      var score = calculateConfidence();

      setTimeout(function() {
        animateScore(score);
      }, 400);

      fillScoreLabel(score);
      fillRouteDesign();
      fillEnvTips();
      fillGearChecklist();

      initScrollAnimationsForResults();
    }

    function calculateConfidence() {
      var score = 50;

      // Factor de distancia (mÃ¡s corto = mÃ¡s seguro para principiantes)
      if (state.distance <= 5) score += 12;
      else if (state.distance <= 10) score += 8;
      else if (state.distance <= 16) score += 4;
      else score += 0;

      // Factor de entorno
      var envScores = { urban: 10, campus: 10, suburban: 7, waterfront: 6, park: 4, travel: 3 };
      score += envScores[state.environment] || 5;

      // Factor de comodidad
      if (state.comfort === 'busy') score += 8;
      else if (state.comfort === 'mixed') score += 5;
      else score += 2;

      // Factor de superficie
      if (state.surface === 'paved') score += 6;
      else if (state.surface === 'mixed-surface') score += 4;
      else score += 2;

      // Factor de iluminaciÃ³n
      if (state.lighting === 'well-lit') score += 8;
      else if (state.lighting === 'some-dark') score += 5;
      else score += 3;

      // Factor de tiempo
      var timeScores = { 'before-sunset': 10, 'dusk': 8, 'early-evening': 6, 'late-evening': 3, 'after-midnight': 1 };
      score += timeScores[state.time] || 4;

      return Math.min(Math.max(score, 30), 98);
    }

    function animateScore(target) {
      var el = document.getElementById('rb-confidence-score');
      var bar = document.getElementById('rb-score-bar');
      if (!el) return;

      var current = 0;
      var duration = 1500;
      var startTime = null;

      function step(timestamp) {
        if (!startTime) startTime = timestamp;
        var progress = Math.min((timestamp - startTime) / duration, 1);
        var eased = 1 - Math.pow(1 - progress, 3);
        current = Math.round(target * eased);
        el.textContent = current;
        if (bar) bar.style.width = current + '%';
        if (progress < 1) requestAnimationFrame(step);
      }
      requestAnimationFrame(step);
    }

    function fillScoreLabel(score) {
      var el = document.getElementById('rb-score-label');
      if (!el) return;

      if (score >= 85) {
        el.textContent = 'Perfil de condiciones excelente. Tus selecciones indican una ruta de alta seguridad con fuerte soporte de infraestructura. La confianza es alta â€” disfruta la carrera.';
      } else if (score >= 70) {
        el.textContent = 'Perfil de ruta fuerte. Tu combinaciÃ³n de entorno, iluminaciÃ³n y horario crea una base sÃ³lida. Sigue los consejos a continuaciÃ³n para maximizar tu seguridad.';
      } else if (score >= 55) {
        el.textContent = 'Perfil de ruta moderado. Algunas de tus selecciones aÃ±aden complejidad. Presta atenciÃ³n extra a la orientaciÃ³n a continuaciÃ³n y considera la lista de equipamiento cuidadosamente.';
      } else {
        el.textContent = 'Perfil de ruta desafiante. Tus selecciones indican algunos factores de riesgo. Sigue cada recomendaciÃ³n a continuaciÃ³n y considera ajustar la distancia o el horario para tus primeros intentos.';
      }
    }

    function fillRouteDesign() {
      var el = document.getElementById('rb-route-design');
      if (!el) return;

      var tips = [];

      // Circuito vs ida y vuelta
      if (state.distance <= 6) {
        tips.push({
          icon: 'ğŸ”„',
          title: 'Circuito Ãšnico Recomendado',
          text: 'A ' + state.distance + ' km, un circuito Ãºnico es ideal. Comienza y termina en el mismo punto â€” sin repetir pasos, sin patrones predecibles.'
        });
      } else if (state.distance <= 13) {
        tips.push({
          icon: 'ğŸ”„',
          title: 'DiseÃ±o en TrÃ©bol o Figura de Ocho',
          text: 'A ' + state.distance + ' km, usa un patrÃ³n de trÃ©bol o figura de ocho. Esto te mantiene dentro de una zona familiar mientras cubres distancia, con mÃºltiples puntos de salida de regreso a tu inicio.'
        });
      } else {
        tips.push({
          icon: 'ğŸ”„',
          title: 'Estrategia de Circuitos Apilados',
          text: 'A ' + state.distance + ' km, planifica 2-3 circuitos apilados desde una base. AsÃ­ pasas por tu punto de inicio cada 5-6 km â€” perfecto para hidrataciÃ³n, controles de seguridad y la opciÃ³n de acortar.'
        });
      }

      // OrientaciÃ³n basada en tiempo
      if (state.time === 'before-sunset' || state.time === 'dusk') {
        tips.push({
          icon: 'ğŸŒ…',
          title: 'PlanificaciÃ³n de TransiciÃ³n al Atardecer',
          text: 'Planifica tu ruta para que la primera mitad se aleje de tu punto de inicio. A medida que cae la oscuridad en tu regreso, cubrirÃ¡s terreno familiar â€” esto hace que la transiciÃ³n se sienta natural.'
        });
      } else if (state.time === 'late-evening' || state.time === 'after-midnight') {
        tips.push({
          icon: 'ğŸŒ™',
          title: 'Estrategia de Corredor Nocturno',
          text: 'Mantente en corredores principales donde los negocios nocturnos (gasolineras, restaurantes, tiendas 24 horas) proporcionan luz ambiental y presencia humana. Evita callejones sin salida residenciales.'
        });
      } else {
        tips.push({
          icon: 'ğŸ™ï¸',
          title: 'Ventaja de la Primera Noche',
          text: 'La primera noche es el momento ideal para correr. Restaurantes y tiendas estÃ¡n abiertos, las calles estÃ¡n activas y la iluminaciÃ³n estÃ¡ completamente encendida. Usa esta ventana para explorar nuevas rutas.'
        });
      }

      // Puntos de salida
      var bailInterval = state.distance <= 8 ? 'cada kilÃ³metro' : 'cada 2 kilÃ³metros';
      tips.push({
        icon: 'ğŸšª',
        title: 'PlanificaciÃ³n de Puntos de Salida',
        text: 'Mapea al menos un punto de salida ' + bailInterval + '. Identifica ubicaciones bien iluminadas (tiendas, gasolineras, intersecciones concurridas) donde puedas detenerte, pedir transporte o esperar de forma segura.'
      });

      // DirecciÃ³n
      if (state.comfort === 'busy') {
        tips.push({
          icon: 'ğŸ‘€',
          title: 'Corre Contra el TrÃ¡fico',
          text: 'En calles sin acera, corre de frente al trÃ¡fico para poder ver los vehÃ­culos que se acercan. En aceras, elige el lado con mejor iluminaciÃ³n.'
        });
      }

      el.innerHTML = tips.map(function(t) {
        return '<div style="display:flex; gap:var(--space-md); padding:var(--space-lg); background:rgba(255,255,255,0.02); border:1px solid var(--border-subtle); border-radius:var(--radius-md);">' +
          '<div style="font-size:24px; flex-shrink:0;">' + t.icon + '</div>' +
          '<div><div style="font-weight:700; margin-bottom:var(--space-xs);">' + t.title + '</div>' +
          '<div style="font-size:var(--text-sm); color:var(--text-secondary); line-height:1.7;">' + t.text + '</div></div></div>';
      }).join('');
    }

    function fillEnvTips() {
      var el = document.getElementById('rb-env-tips');
      if (!el) return;

      var tipsMap = {
        urban: [
          { icon: 'ğŸš¦', text: 'Usa semÃ¡foros y cruces peatonales como puntos de control integrados. Sincroniza tus circuitos para aprovechar las luces verdes.' },
          { icon: 'ğŸª', text: 'Traza tu ruta pasando por negocios abiertos â€” proporcionan luz, testigos y opciones de emergencia.' },
          { icon: 'ğŸ‘¥', text: 'Corre durante la hora de la cena (18-20h) para mÃ¡xima actividad callejera y seguridad.' },
          { icon: 'ğŸš—', text: 'Usa ropa reflectante en tobillos y muÃ±ecas â€” los conductores ven primero el movimiento en las extremidades.' }
        ],
        suburban: [
          { icon: 'ğŸ’¡', text: 'Mantente en calles con alumbrado pÃºblico consistente. Reconoce las Ã¡reas problemÃ¡ticas a la luz del dÃ­a primero.' },
          { icon: 'ğŸ ', text: 'Nota quÃ© casas tienen luces de porche y sensores de movimiento â€” estas se convierten en tu red de seguridad.' },
          { icon: 'ğŸ•', text: 'Ten cuidado con perros sueltos. Lleva una linterna pequeÃ±a para disuadir animales si es necesario.' },
          { icon: 'ğŸ”€', text: 'VarÃ­a tu patrÃ³n de ruta â€” no corras el mismo circuito a la misma hora todas las noches.' }
        ],
        campus: [
          { icon: 'ğŸ”µ', text: 'Mapea todas las estaciones de emergencia de luz azul a lo largo de tu ruta. Corre dentro de su Ã¡rea de cobertura.' },
          { icon: 'ğŸ«', text: 'Usa los perÃ­metros de edificios bien iluminados como corredores. Los edificios acadÃ©micos a menudo tienen excelente iluminaciÃ³n exterior.' },
          { icon: 'ğŸ‘®', text: 'Memoriza el nÃºmero de seguridad del campus y nota los patrones de patrullaje.' },
          { icon: 'ğŸš¶', text: 'Corre cuando otros estudiantes estÃ©n caminando â€” despuÃ©s de clases nocturnas u horas de biblioteca.' }
        ],
        park: [
          { icon: 'ğŸ”¦', text: 'Una linterna frontal de 400+ lÃºmenes es esencial. Lleva una fuente de luz de respaldo.' },
          { icon: 'ğŸŒ¿', text: 'Mantente en los caminos principales â€” las bifurcaciones de senderos son donde la gente se pierde de noche. Conoce la ruta.' },
          { icon: 'ğŸ“±', text: 'Descarga mapas offline. La cobertura celular puede ser irregular en los parques.' },
          { icon: 'ğŸƒ', text: 'Corre las rutas del parque de dÃ­a primero para memorizar terreno, giros y cambios de superficie.' }
        ],
        waterfront: [
          { icon: 'ğŸ’¨', text: 'El viento es mÃ¡s fuerte cerca del agua. VÃ­stete con capas resistentes al viento y protege la piel expuesta.' },
          { icon: 'ğŸŒŠ', text: 'Mantente lejos de bordes del agua sin valla. Las superficies mojadas son resbaladizas â€” reduce el ritmo en las curvas.' },
          { icon: 'ğŸ”†', text: 'Los caminos costaneros a menudo tienen brechas de iluminaciÃ³n. Lleva tu propia luz incluso si la ruta estÃ¡ "iluminada".' },
          { icon: 'ğŸ§­', text: 'Los caminos costaneros pueden sentirse aislados. Corre durante horas cuando hay paseantes de perros y otros corredores presentes.' }
        ],
        travel: [
          { icon: 'ğŸ¨', text: 'Haz un reconocimiento a pie durante el dÃ­a primero. Nota puntos de referencia, negocios seguros y la ubicaciÃ³n exacta de tu hotel.' },
          { icon: 'ğŸ“', text: 'Mantente dentro de un radio de 1.5 km de tu hotel en tu primera carrera nocturna en una ciudad nueva.' },
          { icon: 'ğŸ—£ï¸', text: 'Pregunta en recepciÃ³n sobre rutas seguras para correr â€” el personal del hotel conoce la zona.' },
          { icon: 'ğŸ“±', text: 'Haz captura de pantalla de tu ruta y la direcciÃ³n del hotel. No dependas de datos mÃ³viles en zonas desconocidas.' }
        ]
      };

      var tips = tipsMap[state.environment] || tipsMap.urban;
      el.innerHTML = tips.map(function(t) {
        return '<div style="display:flex; gap:var(--space-md); padding:var(--space-md) var(--space-lg); background:rgba(255,255,255,0.02); border:1px solid var(--border-subtle); border-radius:var(--radius-md);">' +
          '<div style="font-size:20px; flex-shrink:0;">' + t.icon + '</div>' +
          '<div style="font-size:var(--text-sm); color:var(--text-secondary); line-height:1.7;">' + t.text + '</div></div>';
      }).join('');
    }

    function fillGearChecklist() {
      var el = document.getElementById('rb-gear-checklist');
      if (!el) return;

      var items = [];

      // Elementos universales
      items.push('TelÃ©fono â€” completamente cargado, con ubicaciÃ³n compartida activa');
      items.push('IdentificaciÃ³n e informaciÃ³n de contacto de emergencia');

      // Basado en iluminaciÃ³n
      if (state.lighting === 'own-light') {
        items.push('Linterna frontal o de cintura principal (400+ lÃºmenes recomendados)');
        items.push('Fuente de luz de respaldo (pequeÃ±a clip-on o de mano)');
      } else if (state.lighting === 'some-dark') {
        items.push('Linterna frontal o de cintura para tramos oscuros');
      } else {
        items.push('PequeÃ±a luz clip-on (para visibilidad, incluso en rutas iluminadas)');
      }

      // Siempre reflectante
      items.push('Chaleco o chaqueta reflectante');
      items.push('Bandas reflectantes en tobillos y muÃ±ecas');

      // Basado en superficie
      if (state.surface === 'trail-ok') {
        items.push('Zapatillas de trail con buen agarre');
        items.push('Polainas si corres en terreno suelto');
      } else if (state.surface === 'mixed-surface') {
        items.push('Zapatillas con suela versÃ¡til para superficies mixtas');
      }

      // Basado en distancia
      if (state.distance >= 10) {
        items.push('HidrataciÃ³n â€” botella de mano o chaleco de hidrataciÃ³n');
      }
      if (state.distance >= 16) {
        items.push('NutriciÃ³n â€” geles o gomitas para energÃ­a sostenida');
        items.push('Capa extra en caso de tiempo prolongado al aire libre');
      }

      // Basado en tiempo
      if (state.time === 'late-evening' || state.time === 'after-midnight') {
        items.push('Alarma personal de seguridad o silbato');
        items.push('Spray de pimienta o dispositivo de seguridad personal (donde sea legal)');
      }

      // Basado en entorno
      if (state.environment === 'waterfront') {
        items.push('Capa exterior resistente al viento');
      }
      if (state.environment === 'travel') {
        items.push('Llave del hotel y tarjeta con direcciÃ³n');
        items.push('Moneda local / mÃ©todo de pago para transporte de emergencia');
      }

      // Siempre al final
      items.push('Comparte tu ruta y hora estimada de llegada con un contacto de confianza');

      el.innerHTML = items.map(function(item, i) {
        return '<label style="display:flex; align-items:flex-start; gap:var(--space-md); padding:var(--space-md); background:rgba(255,255,255,0.02); border:1px solid var(--border-subtle); border-radius:var(--radius-md); cursor:pointer; transition:all var(--transition-fast);" onmouseover="this.style.background=\'rgba(0,212,255,0.05)\'" onmouseout="this.style.background=\'rgba(255,255,255,0.02)\'">' +
          '<input type="checkbox" id="gear-' + i + '" style="margin-top:3px; accent-color:var(--accent-primary); width:18px; height:18px; flex-shrink:0;">' +
          '<span style="font-size:var(--text-sm); color:var(--text-secondary); line-height:1.5;">' + item + '</span></label>';
      }).join('');
    }

    // ============================================================
    // Acciones de Resultados
    // ============================================================
    function initResultActions() {
      // Compartir
      var shareBtn = document.getElementById('rb-share-btn');
      if (shareBtn) {
        shareBtn.addEventListener('click', function() {
          var summary = buildShareText();
          if (navigator.share) {
            navigator.share({
              title: 'Mi Estrategia de Ruta Nocturna â€” RunSafeTonight',
              text: summary,
              url: window.location.href
            }).catch(function() {});
          } else if (navigator.clipboard) {
            navigator.clipboard.writeText(summary).then(function() {
              showToast('Plan de ruta copiado al portapapeles. Â¡CompÃ¡rtelo con un amigo!');
            });
          } else {
            showToast('Comparte tu plan con un contacto de confianza antes de salir.');
          }
        });
      }

      // Descargar
      var downloadBtn = document.getElementById('rb-download-btn');
      if (downloadBtn) {
        downloadBtn.addEventListener('click', function() {
          downloadChecklist();
        });
      }

      // Reiniciar
      var restartBtn = document.getElementById('rb-restart-btn');
      if (restartBtn) {
        restartBtn.addEventListener('click', function() {
          resetTool();
        });
      }
    }

    function buildShareText() {
      var envNames = { urban: 'Centro Urbano', suburban: 'Circuito Suburbano', campus: 'Campus', park: 'Sendero de Parque', waterfront: 'Costanera', travel: 'Viaje / Hotel' };
      var comfortNames = { busy: 'Prefiero calles concurridas', mixed: 'Mezcla', quiet: 'Prefiero rutas tranquilas' };
      var lightNames = { 'well-lit': 'Solo bien iluminado', 'some-dark': 'Algunos tramos oscuros OK', 'own-light': 'Llevo mi propia luz' };
      var timeNames = { 'before-sunset': 'Antes del atardecer', 'dusk': 'Atardecer/crepÃºsculo', 'early-evening': 'Primera noche (18-21h)', 'late-evening': 'Noche avanzada (21h-medianoche)', 'after-midnight': 'DespuÃ©s de medianoche' };

      return 'Mi Plan de Carrera Nocturna (RunSafeTonight.com)\n' +
        '---\n' +
        'Distancia: ' + state.distance + ' km\n' +
        'Entorno: ' + (envNames[state.environment] || state.environment) + '\n' +
        'Comodidad: ' + (comfortNames[state.comfort] || state.comfort) + '\n' +
        'IluminaciÃ³n: ' + (lightNames[state.lighting] || state.lighting) + '\n' +
        'Horario: ' + (timeNames[state.time] || state.time) + '\n' +
        'PuntuaciÃ³n de Confianza: ' + calculateConfidence() + '/100\n' +
        '---\n' +
        'Crea el tuyo: https://runsafetonight.com/es/route-builder/';
    }

    function downloadChecklist() {
      var envNames = { urban: 'Centro Urbano', suburban: 'Circuito Suburbano', campus: 'Campus', park: 'Sendero de Parque', waterfront: 'Costanera', travel: 'Viaje / Hotel' };
      var checkboxes = document.querySelectorAll('#rb-gear-checklist input[type="checkbox"]');
      var items = [];
      checkboxes.forEach(function(cb) {
        var label = cb.parentElement.querySelector('span');
        items.push((cb.checked ? '[x] ' : '[ ] ') + (label ? label.textContent : ''));
      });

      var text = 'LISTA DE VERIFICACIÃ“N PRE-CARRERA NOCTURNA\n';
      text += 'Generada por RunSafeTonight.com Constructor de Rutas Nocturnas\n';
      text += '================================================\n\n';
      text += 'PERFIL DE RUTA:\n';
      text += '  Distancia: ' + state.distance + ' km\n';
      text += '  Entorno: ' + (envNames[state.environment] || state.environment) + '\n';
      text += '  Horario: ' + (state.time || 'No definido') + '\n';
      text += '  PuntuaciÃ³n de Confianza: ' + calculateConfidence() + '/100\n\n';
      text += 'LISTA DE EQUIPAMIENTO:\n';
      items.forEach(function(item) { text += '  ' + item + '\n'; });
      text += '\nRECORDATORIOS PRE-CARRERA:\n';
      text += '  [ ] Ruta compartida con contacto de confianza\n';
      text += '  [ ] TelÃ©fono completamente cargado\n';
      text += '  [ ] UbicaciÃ³n compartida activada\n';
      text += '  [ ] Hora estimada de regreso comunicada\n';
      text += '  [ ] Clima verificado\n';
      text += '  [ ] Puntos de salida identificados\n\n';
      text += 'POST-CARRERA:\n';
      text += '  [ ] Avisar a contacto de seguridad\n';
      text += '  [ ] Anotar problemas de ruta para la prÃ³xima vez\n';
      text += '  [ ] Registrar tu carrera\n\n';
      text += '---\n';
      text += 'La noche te pertenece. Corre con confianza.\n';
      text += 'https://runsafetonight.com/es/route-builder/\n';

      var blob = new Blob([text], { type: 'text/plain' });
      var url = URL.createObjectURL(blob);
      var a = document.createElement('a');
      a.href = url;
      a.download = 'lista-carrera-nocturna.txt';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);

      showToast('Lista descargada. Â¡RevÃ­sala antes de tu carrera!');
    }

    function resetTool() {
      state = { step: 1, distance: 8, environment: null, comfort: null, surface: null, lighting: null, time: null };

      var stepsContainer = document.getElementById('rb-steps-container');
      var progressSection = document.getElementById('rb-progress-section');
      var results = document.getElementById('rb-results');
      if (stepsContainer) stepsContainer.style.display = 'block';
      if (progressSection) progressSection.style.display = 'block';
      if (results) results.style.display = 'none';

      var slider = document.getElementById('rb-distance-slider');
      if (slider) slider.value = 8;
      var display = document.getElementById('rb-distance-display');
      if (display) display.textContent = '8';

      document.querySelectorAll('.rb-option-card, .rb-option-btn').forEach(function(el) {
        el.classList.remove('selected');
      });

      document.querySelectorAll('.rb-next-btn, .rb-generate-btn').forEach(function(btn) {
        if (btn.closest('.rb-step[data-step="1"]')) return;
        btn.disabled = true;
        btn.style.opacity = '0.5';
      });

      document.querySelectorAll('#rb-gear-checklist input[type="checkbox"]').forEach(function(cb) {
        cb.checked = false;
      });

      goToStep(1);
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // ============================================================
    // Utilidades
    // ============================================================
    function showToast(message) {
      var toast = document.getElementById('toast');
      if (!toast) return;
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(function() { toast.classList.remove('show'); }, 4000);
    }

    function initScrollAnimationsForResults() {
      var elements = document.querySelectorAll('#rb-results .fade-in');
      if (!elements.length) return;
      var observer = new IntersectionObserver(function(entries) {
        entries.forEach(function(entry) {
          if (entry.isIntersecting) {
            entry.target.classList.add('visible');
            observer.unobserve(entry.target);
          }
        });
      }, { threshold: 0.1, rootMargin: '0px 0px -50px 0px' });
      elements.forEach(function(el) { observer.observe(el); });
    }

  })();
  </script>

  <!-- ====== ESTILOS ESPECÃFICOS DE PÃGINA ====== -->
  <style>
    /* Tarjetas de OpciÃ³n (Paso 2) */
    .rb-option-card {
      background: var(--bg-card);
      border: 2px solid var(--border-subtle);
      border-radius: var(--radius-lg);
      padding: var(--space-xl);
      text-align: center;
      cursor: pointer;
      transition: all var(--transition-base);
      display: flex;
      flex-direction: column;
      align-items: center;
      color: var(--text-primary);
      font-family: inherit;
      font-size: inherit;
    }

    .rb-option-card:hover {
      border-color: var(--border-accent);
      background: rgba(0, 212, 255, 0.05);
      transform: translateY(-2px);
    }

    .rb-option-card.selected {
      border-color: var(--accent-primary);
      background: rgba(0, 212, 255, 0.1);
      box-shadow: 0 0 20px rgba(0, 212, 255, 0.15);
    }

    /* Botones de OpciÃ³n (Pasos 3-6) */
    .rb-option-btn {
      display: flex;
      align-items: flex-start;
      gap: var(--space-md);
      padding: var(--space-lg) var(--space-xl);
      background: var(--bg-card);
      border: 2px solid var(--border-subtle);
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: all var(--transition-base);
      text-align: left;
      width: 100%;
      color: var(--text-primary);
      font-family: inherit;
      font-size: inherit;
    }

    .rb-option-btn:hover {
      border-color: var(--border-accent);
      background: rgba(0, 212, 255, 0.05);
      transform: translateX(4px);
    }

    .rb-option-btn.selected {
      border-color: var(--accent-primary);
      background: rgba(0, 212, 255, 0.1);
      box-shadow: 0 0 20px rgba(0, 212, 255, 0.15);
    }

    /* Transiciones de pasos */
    .rb-step {
      transition: opacity 0.4s ease, transform 0.4s ease;
    }

    /* Responsive para tarjetas de opciÃ³n */
    @media (max-width: 480px) {
      .rb-option-card {
        padding: var(--space-lg);
      }

      #rb-step-2 > div:nth-child(2) {
        grid-template-columns: 1fr;
      }
    }
  </style>

</body>
</html>
